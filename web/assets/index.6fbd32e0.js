import{B as $e,t as Ce,C as ke,_ as De}from"./index.15381f0b.js";/* empty css              *//* empty css               *//* empty css               *//* empty css              *//* empty css               *//* empty css              *//* empty css              *//* empty css               *//* empty css               *//* empty css               */import{d as he,j as v,r as X,o as we,C as A,D as j,aI as t,aH as a,aM as s,aN as l,u as Fe,aK as Be,aJ as Pe,aE as Ae,E as c,aX as p,b2 as Q,aT as L,a6 as Ee,aY as Te,ba as ze,bO as Ve,bP as Me,bQ as je,bl as Ie,bR as Re,bS as Ue,b7 as We,bc as Se,bT as Ke,bU as Le,bb as Ne,bV as Ye,bW as Oe,bw as qe,ae as He,bX as Je,bv as Xe,aZ as Qe,bs as Ze,bY as Ge,bt as xe}from"./arco.2804d378.js";import{f as et}from"./vue.bbad6851.js";import{u as tt}from"./loading.4e91d3ac.js";import{g as at,a as nt,b as ot,c as lt,d as st,r as it}from"./cert.1499a4e5.js";import"./chart.100020e2.js";const rt={class:"container"},ut={key:0},dt={class:"cert-content-header"},ct={class:"cert-content"},mt={class:"cert-content-header"},pt={class:"cert-content"},ft={class:"cert-content-header"},vt={class:"cert-content"},_t={class:"cert-content-header"},yt={class:"cert-content"},bt={class:"cert-content-header"},gt={style:{"font-weight":"bold"}},$t={class:"cert-content"},Ct={class:"cert-content-header"},kt={style:{"font-weight":"bold"}},Dt={class:"cert-content"},ht={class:"cert-content-header"},wt={style:{"font-weight":"bold"}},Ft={class:"cert-content"},Bt={key:1},Pt=he({__name:"index",setup(At){const Z=et(),{loading:G,setLoading:N}=tt(!0),w=v(!1),Y=v([]),I=X({...{current:1,pageSize:10,total:0}}),x=v(),_=X({domain:"",dnsProvider:""}),F=v(!1),O=v([]),E=v(!1),d=v(null),T=v(!1),y=v({cert:"",key:""}),m=v({config:""}),q=v("cert");async function z(){N(!0);try{const{data:e}=await at();if(e){I.total=e.length;const o=e.map(i=>({domain:i.domain,certPath:i.cert_path,keyPath:i.key_path,issuedAt:i.issued_at,expiresAt:i.expires_at,isWildcard:i.is_wildcard,lastRenewalAt:i.last_renewal_at,dnsProvider:i.dns_provider}));Y.value=o}}catch{p.error({content:"\u83B7\u53D6\u57DF\u540D\u5217\u8868\u5931\u8D25",duration:5e3})}finally{N(!1)}}async function ee(){try{const{data:e}=await nt();e&&(O.value=e)}catch{p.error({content:"\u83B7\u53D6DNS\u63D0\u4F9B\u5546\u5217\u8868\u5931\u8D25",duration:5e3})}}we(()=>{z(),ee()});const te=e=>{I.current=e},ae=()=>{_.domain="",_.dnsProvider="",F.value=!0},ne=async()=>{const{domain:e,dnsProvider:o}=_;if(!e||!o)return p.error("\u8BF7\u586B\u5199\u5B8C\u6574\u4FE1\u606F"),!1;try{return await ot(e,o),F.value=!1,z(),!0}catch{return p.error("\u6DFB\u52A0\u57DF\u540D\u5931\u8D25"),!1}},oe=async e=>{d.value=e,E.value=!0},le=async e=>{d.value=e,y.value={cert:"",key:""},m.value={config:""},q.value="cert",T.value=!0,w.value=!0;try{const{data:o}=await lt(e.domain);o&&(y.value=o)}catch{p.error({content:"\u83B7\u53D6\u8BC1\u4E66\u5185\u5BB9\u5931\u8D25",duration:5e3})}finally{w.value=!1}},se=async e=>{var o;if(q.value=e,e!=="cert"&&e!=="key"&&!m.value[e]){w.value=!0;try{const i=e==="tomcat"?"pkcs12":e,{data:u}=await st(((o=d.value)==null?void 0:o.domain)||"",i);u&&(m.value=u)}catch{p.error({content:`\u83B7\u53D6${e}\u683C\u5F0F\u8BC1\u4E66\u5931\u8D25`,duration:5e3})}finally{w.value=!1}}},R=(e,o)=>{if(!d.value)return;const i=d.value.domain,u=m.value[e];if(!u){p.error("\u6587\u4EF6\u5185\u5BB9\u4E0D\u5B58\u5728");return}const V=window.atob(u),P=V.length,M=new Uint8Array(P);for(let b=0;b<P;b++)M[b]=V.charCodeAt(b);const U=new Blob([M],{type:"application/octet-stream"}),f=document.createElement("a");f.href=URL.createObjectURL(U),f.download=`${i}.${o}`,document.body.appendChild(f),f.click(),document.body.removeChild(f),p.success(`\u6210\u529F\u4E0B\u8F7D ${i}.${o}`)},$=(e,o)=>{if(!e){p.error("\u6CA1\u6709\u5185\u5BB9\u53EF\u590D\u5236");return}navigator.clipboard.writeText(e).then(()=>{let i="";switch(o){case"cert":i="\u590D\u5236\u8BC1\u4E66\u5185\u5BB9\u6210\u529F";break;case"key":i="\u590D\u5236\u79C1\u94A5\u5185\u5BB9\u6210\u529F";break;case"nginx":i="\u590D\u5236Nginx\u914D\u7F6E\u6210\u529F";break;case"apache":i="\u590D\u5236Apache\u914D\u7F6E\u6210\u529F";break;case"tomcat":i="\u590D\u5236Tomcat\u914D\u7F6E\u6210\u529F";break;case"iis":i="\u590D\u5236IIS\u914D\u7F6E\u6210\u529F";break;case"jks":i="\u590D\u5236JKS\u914D\u7F6E\u6210\u529F";break;default:i="\u590D\u5236\u6210\u529F"}p.success(i)}).catch(()=>{p.error("\u590D\u5236\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u6D4F\u89C8\u5668\u6743\u9650")})},ie=e=>{Z.push({path:"/cert/deploy",query:{domain:e.domain}})},re=e=>{Q.warning({title:"\u786E\u8BA4\u5220\u9664",content:`\u786E\u5B9A\u8981\u5220\u9664\u57DF\u540D ${e.domain} \u7684\u8BC1\u4E66\u5417\uFF1F`,onOk:async()=>{try{await it(e.domain),p.success("\u5220\u9664\u6210\u529F"),z()}catch{p.error("\u5220\u9664\u5931\u8D25")}}})},B=e=>e?L(e).format("YYYY-MM-DD HH:mm:ss"):"-",ue=e=>{if(!e)return"gray";const o=L(),u=L(e).diff(o,"day");return u<0?"red":u<30?"orange":"green"};return(e,o)=>{const i=Ee,u=Te,V=Ce,P=ze,M=Ve,U=Me,f=je,b=Ie,de=Re,ce=Ue,me=We,H=Se,pe=Ke,fe=Le,ve=Ne,W=Q,g=Ye,_e=Oe,C=qe,k=He,D=Je,h=Xe,S=ke,K=Qe,ye=Ze,be=Ge,ge=xe;return A(),j("div",rt,[t($e,{items:["menu.operation.cert","menu.operation.cert.domains"]}),t(ce,{class:"general-card",title:e.$t("menu.operation.cert.domains")},{default:a(()=>[t(U,{style:{"margin-bottom":"16px"}},{default:a(()=>[t(M,{flex:1},{default:a(()=>[t(P,null,{default:a(()=>[t(u,{type:"primary",onClick:ae},{icon:a(()=>[t(i)]),default:a(()=>[s(" "+l(e.$t("cert.domains.add")),1)]),_:1}),t(u,{onClick:z},{icon:a(()=>[t(V)]),default:a(()=>[s(" "+l(e.$t("cert.refresh")),1)]),_:1})]),_:1})]),_:1})]),_:1}),t(de,{"row-key":"domain",loading:Fe(G),pagination:I,data:Y.value,bordered:!1,onPageChange:te},{columns:a(()=>[t(f,{title:e.$t("cert.domains.domain"),"data-index":"domain"},null,8,["title"]),t(f,{title:e.$t("cert.domains.isWildcard"),"data-index":"isWildcard"},{cell:a(({record:n})=>[t(b,{color:n.isWildcard?"green":"blue"},{default:a(()=>[s(l(n.isWildcard?e.$t("cert.yes"):e.$t("cert.no")),1)]),_:2},1032,["color"])]),_:1},8,["title"]),t(f,{title:e.$t("cert.domains.issuedAt"),"data-index":"issuedAt"},{cell:a(({record:n})=>[s(l(B(n.issuedAt)),1)]),_:1},8,["title"]),t(f,{title:e.$t("cert.domains.expiresAt"),"data-index":"expiresAt"},{cell:a(({record:n})=>[t(b,{color:ue(n.expiresAt)},{default:a(()=>[s(l(B(n.expiresAt)),1)]),_:2},1032,["color"])]),_:1},8,["title"]),t(f,{title:e.$t("cert.domains.dnsProvider"),"data-index":"dnsProvider"},null,8,["title"]),t(f,{title:e.$t("cert.operations"),"data-index":"operations",width:220},{cell:a(({record:n})=>[t(P,null,{default:a(()=>[t(u,{type:"text",size:"small",onClick:r=>oe(n)},{default:a(()=>[s(l(e.$t("cert.view")),1)]),_:2},1032,["onClick"]),t(u,{type:"text",size:"small",onClick:r=>le(n)},{default:a(()=>[s(l(e.$t("cert.domains.viewCert")),1)]),_:2},1032,["onClick"]),t(u,{type:"text",size:"small",onClick:r=>ie(n)},{default:a(()=>[s(l(e.$t("cert.domains.manageDeploy")),1)]),_:2},1032,["onClick"]),t(u,{type:"text",status:"danger",size:"small",onClick:r=>re(n)},{default:a(()=>[s(l(e.$t("cert.delete")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:1},8,["title"])]),_:1},8,["loading","pagination","data"])]),_:1},8,["title"]),t(W,{visible:F.value,"onUpdate:visible":o[2]||(o[2]=n=>F.value=n),title:e.$t("cert.domains.add"),onCancel:o[3]||(o[3]=n=>F.value=!1),onBeforeOk:ne},{default:a(()=>[t(ve,{ref_key:"formRef",ref:x,model:_},{default:a(()=>[t(H,{field:"domain",label:e.$t("cert.domains.domain"),required:""},{default:a(()=>[t(me,{modelValue:_.domain,"onUpdate:modelValue":o[0]||(o[0]=n=>_.domain=n),placeholder:e.$t("cert.domains.domainPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(H,{field:"dnsProvider",label:e.$t("cert.domains.dnsProvider"),required:""},{default:a(()=>[t(fe,{modelValue:_.dnsProvider,"onUpdate:modelValue":o[1]||(o[1]=n=>_.dnsProvider=n),placeholder:e.$t("cert.domains.dnsProviderPlaceholder")},{default:a(()=>[(A(!0),j(Be,null,Pe(O.value,n=>(A(),Ae(pe,{key:n.name,value:n.name},{default:a(()=>[s(l(n.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["visible","title"]),t(W,{visible:E.value,"onUpdate:visible":o[4]||(o[4]=n=>E.value=n),title:e.$t("cert.domains.detail"),footer:!1,onCancel:o[5]||(o[5]=n=>E.value=!1)},{default:a(()=>{var n;return[t(_e,{title:(n=d.value)==null?void 0:n.domain,bordered:"",column:1},{default:a(()=>[t(g,{label:e.$t("cert.domains.domain")},{default:a(()=>{var r;return[s(l((r=d.value)==null?void 0:r.domain),1)]}),_:1},8,["label"]),t(g,{label:e.$t("cert.domains.isWildcard")},{default:a(()=>{var r;return[t(b,{color:(r=d.value)!=null&&r.isWildcard?"green":"blue"},{default:a(()=>{var J;return[s(l((J=d.value)!=null&&J.isWildcard?e.$t("cert.yes"):e.$t("cert.no")),1)]}),_:1},8,["color"])]}),_:1},8,["label"]),t(g,{label:e.$t("cert.domains.certPath")},{default:a(()=>{var r;return[s(l((r=d.value)==null?void 0:r.certPath),1)]}),_:1},8,["label"]),t(g,{label:e.$t("cert.domains.keyPath")},{default:a(()=>{var r;return[s(l((r=d.value)==null?void 0:r.keyPath),1)]}),_:1},8,["label"]),t(g,{label:e.$t("cert.domains.issuedAt")},{default:a(()=>{var r;return[s(l(B((r=d.value)==null?void 0:r.issuedAt)),1)]}),_:1},8,["label"]),t(g,{label:e.$t("cert.domains.expiresAt")},{default:a(()=>{var r;return[s(l(B((r=d.value)==null?void 0:r.expiresAt)),1)]}),_:1},8,["label"]),t(g,{label:e.$t("cert.domains.lastRenewalAt")},{default:a(()=>{var r;return[s(l(B((r=d.value)==null?void 0:r.lastRenewalAt)),1)]}),_:1},8,["label"]),t(g,{label:e.$t("cert.domains.dnsProvider")},{default:a(()=>{var r;return[s(l((r=d.value)==null?void 0:r.dnsProvider),1)]}),_:1},8,["label"])]),_:1},8,["title"])]}),_:1},8,["visible","title"]),t(W,{visible:T.value,"onUpdate:visible":o[16]||(o[16]=n=>T.value=n),title:e.$t("cert.domains.certContent"),footer:!1,width:"1200px",onCancel:o[17]||(o[17]=n=>T.value=!1)},{default:a(()=>[t(ge,{loading:w.value},{default:a(()=>[y.value.cert||y.value.key?(A(),j("div",ut,[t(ye,{onTabClick:se},{default:a(()=>[t(h,{key:"cert",title:e.$t("cert.domains.publicKey")},{default:a(()=>[c("div",dt,[t(C,{heading:6},{default:a(()=>{var n;return[s(l((n=d.value)==null?void 0:n.domain)+" "+l(e.$t("cert.domains.publicKey")),1)]}),_:1}),t(u,{type:"primary",size:"small",onClick:o[6]||(o[6]=n=>$(y.value.cert,"cert"))},{icon:a(()=>[t(k)]),default:a(()=>[s(" "+l(e.$t("cert.copy")),1)]),_:1})]),t(D),c("pre",ct,l(y.value.cert),1)]),_:1},8,["title"]),t(h,{key:"key",title:e.$t("cert.domains.privateKey")},{default:a(()=>[c("div",mt,[t(C,{heading:6},{default:a(()=>{var n;return[s(l((n=d.value)==null?void 0:n.domain)+" "+l(e.$t("cert.domains.privateKey")),1)]}),_:1}),t(u,{type:"primary",size:"small",onClick:o[7]||(o[7]=n=>$(y.value.key,"key"))},{icon:a(()=>[t(k)]),default:a(()=>[s(" "+l(e.$t("cert.copy")),1)]),_:1})]),t(D),c("pre",pt,l(y.value.key),1)]),_:1},8,["title"]),t(h,{key:"nginx",title:e.$t("cert.server.nginx")},{default:a(()=>[c("div",ft,[t(C,{heading:6},{default:a(()=>{var n;return[s(l((n=d.value)==null?void 0:n.domain)+" "+l(e.$t("cert.server.nginxConfig")),1)]}),_:1}),t(u,{type:"primary",size:"small",onClick:o[8]||(o[8]=n=>$(m.value.config||"","nginx"))},{icon:a(()=>[t(k)]),default:a(()=>[s(" "+l(e.$t("cert.copy")),1)]),_:1})]),t(D),c("pre",vt,l(m.value.config),1)]),_:1},8,["title"]),t(h,{key:"apache",title:e.$t("cert.server.apache")},{default:a(()=>[c("div",_t,[t(C,{heading:6},{default:a(()=>{var n;return[s(l((n=d.value)==null?void 0:n.domain)+" "+l(e.$t("cert.server.apacheConfig")),1)]}),_:1}),t(u,{type:"primary",size:"small",onClick:o[9]||(o[9]=n=>$(m.value.config||"","apache"))},{icon:a(()=>[t(k)]),default:a(()=>[s(" "+l(e.$t("cert.copy")),1)]),_:1})]),t(D),c("pre",yt,l(m.value.config),1)]),_:1},8,["title"]),t(h,{key:"tomcat",title:e.$t("cert.server.tomcat")},{default:a(()=>[c("div",bt,[t(C,{heading:6},{default:a(()=>{var n;return[s(l((n=d.value)==null?void 0:n.domain)+" "+l(e.$t("cert.server.tomcatConfig")),1)]}),_:1}),c("div",null,[t(u,{type:"primary",size:"small",style:{"margin-right":"8px"},onClick:o[10]||(o[10]=n=>R("pkcs12","p12"))},{icon:a(()=>[t(S)]),default:a(()=>[s(" "+l(e.$t("cert.download.p12")),1)]),_:1}),t(u,{type:"primary",size:"small",onClick:o[11]||(o[11]=n=>$(m.value.config||"","tomcat"))},{icon:a(()=>[t(k)]),default:a(()=>[s(" "+l(e.$t("cert.copy")),1)]),_:1})])]),t(K,{type:"info",style:{"margin-bottom":"10px"}},{message:a(()=>[s(l(e.$t("cert.password"))+": ",1),c("span",gt,l(m.value.password||"changeit"),1)]),_:1}),t(D),c("pre",$t,l(m.value.config),1)]),_:1},8,["title"]),t(h,{key:"iis",title:e.$t("cert.server.iis")},{default:a(()=>[c("div",Ct,[t(C,{heading:6},{default:a(()=>{var n;return[s(l((n=d.value)==null?void 0:n.domain)+" "+l(e.$t("cert.server.iisConfig")),1)]}),_:1}),c("div",null,[t(u,{type:"primary",size:"small",style:{"margin-right":"8px"},onClick:o[12]||(o[12]=n=>R("pfx","pfx"))},{icon:a(()=>[t(S)]),default:a(()=>[s(" "+l(e.$t("cert.download.pfx")),1)]),_:1}),t(u,{type:"primary",size:"small",onClick:o[13]||(o[13]=n=>$(m.value.config||"","iis"))},{icon:a(()=>[t(k)]),default:a(()=>[s(" "+l(e.$t("cert.copy")),1)]),_:1})])]),t(K,{type:"info",style:{"margin-bottom":"10px"}},{message:a(()=>[s(l(e.$t("cert.password"))+": ",1),c("span",kt,l(m.value.password||"changeit"),1)]),_:1}),t(D),c("pre",Dt,l(m.value.config),1)]),_:1},8,["title"]),t(h,{key:"jks",title:e.$t("cert.server.jks")},{default:a(()=>[c("div",ht,[t(C,{heading:6},{default:a(()=>{var n;return[s(l((n=d.value)==null?void 0:n.domain)+" "+l(e.$t("cert.server.jksConfig")),1)]}),_:1}),c("div",null,[t(u,{type:"primary",size:"small",style:{"margin-right":"8px"},onClick:o[14]||(o[14]=n=>R("jks","jks"))},{icon:a(()=>[t(S)]),default:a(()=>[s(" "+l(e.$t("cert.download.jks")),1)]),_:1}),t(u,{type:"primary",size:"small",onClick:o[15]||(o[15]=n=>$(m.value.config||"","jks"))},{icon:a(()=>[t(k)]),default:a(()=>[s(" "+l(e.$t("cert.copy")),1)]),_:1})])]),t(K,{type:"info",style:{"margin-bottom":"10px"}},{message:a(()=>[s(l(e.$t("cert.password"))+": ",1),c("span",wt,l(m.value.password||"changeit"),1)]),_:1}),t(D),c("pre",Ft,l(m.value.config),1)]),_:1},8,["title"])]),_:1})])):(A(),j("div",Bt,[t(be)]))]),_:1},8,["loading"])]),_:1},8,["visible","title"])])}}});const Ht=De(Pt,[["__scopeId","data-v-6d717c58"]]);export{Ht as default};
