import{_}from"./index.a81c3a0f.js";/* empty css              *//* empty css                *//* empty css              */import{d as p,j as c,w as D,o as V,bF as R,aT as M,C as $,aE as B,aH as u,aI as r,aM as s,E as q,bT as H,bU as k,ba as z,bS as L}from"./arco.2804d378.js";import{k as O}from"./chart.9f128c58.js";import{q as U,p as Y}from"./monitor.50aeaf0e.js";const j=p({name:"MetricChart",props:{title:{type:String,required:!0},metrics:{type:String,required:!0},startTime:{type:String,default:"-1h"},endTime:{type:String,default:""},interval:{type:String,default:"1m"},chartType:{type:String,default:"line"},colors:{type:Array,default:()=>["#5470c6","#91cc75","#fac858","#ee6666"]},seriesNames:{type:Array,default:()=>[]},yAxisName:{type:String,default:""},yAxisMin:{type:Number,default:void 0},yAxisMax:{type:Number,default:void 0},refreshInterval:{type:Number,default:6e4},refreshTrigger:{type:Number,default:0},selectedNode:{type:Object,default:null}},setup(e,{emit:t}){const h=c(null),o=c(null),N=c(!1),b=c([]),a=c(e.interval),i=c(e.startTime),w=()=>{if(!h.value)return;o.value=O(h.value);const n={tooltip:{trigger:"axis",formatter:l=>{let m=`${M(l[0].value[0]).format("YYYY-MM-DD HH:mm:ss")}<br/>`;return l.forEach(v=>{m+=`${v.marker} ${v.seriesName}: ${v.value[1]}<br/>`}),m}},legend:{data:e.seriesNames.length>0?e.seriesNames:void 0},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"time",axisLabel:{formatter:l=>M(l).format("HH:mm:ss")}},yAxis:{type:"value",name:e.yAxisName,min:e.yAxisMin,max:e.yAxisMax},series:[]};o.value.setOption(n)},E=()=>{if(!o.value)return;const n=b.value.map((l,f)=>({name:l.name,type:e.chartType,smooth:!0,data:l.data,itemStyle:{color:e.colors[f%e.colors.length]}}));o.value.setOption({series:n})},C=n=>{const l=String(n);i.value=l,F(),t("timeRangeChange",l)},A=n=>{const l=String(n);a.value=l,F(),t("intervalChange",l)},F=async()=>{var n;N.value=!0;try{const l=Math.floor(Date.now()/1e3);let f=l-3600;if(i.value)if(i.value.startsWith("-")){const d=parseInt(i.value.substring(1,i.value.length-1)),y=i.value.charAt(i.value.length-1);y==="h"?f=l-d*3600:y==="m"?f=l-d*60:y==="d"&&(f=l-d*86400)}else f=parseInt(i.value);let m,v;if(e.selectedNode){let d=e.selectedNode.address;if(d.includes(":")&&(d=d.split(":")[0]),m=await U(d,((n=e.selectedNode.metadata)==null?void 0:n.http_port)||0,e.metrics,f,e.endTime?parseInt(e.endTime):void 0,a.value),m.data)v=m.data;else throw new Error("\u670D\u52A1\u5668\u8FD4\u56DE\u6570\u636E\u683C\u5F0F\u4E0D\u6B63\u786E")}else if(m=await Y(e.metrics,f,e.endTime?parseInt(e.endTime):void 0,a.value),m.data)v=m.data.data||m.data;else throw new Error("\u670D\u52A1\u5668\u8FD4\u56DE\u6570\u636E\u683C\u5F0F\u4E0D\u6B63\u786E");v&&v.series&&(b.value=v.series.map((d,y)=>{const I=e.seriesNames.length>y?e.seriesNames[y]:d.name,S=d.points.map(T=>[new Date(typeof T.timestamp=="number"?T.timestamp*1e3:T.timestamp),T.value]);return{name:I,data:S}})),E()}catch(l){console.error("\u83B7\u53D6\u6307\u6807\u6570\u636E\u5931\u8D25:",l)}finally{N.value=!1}};let g=null;const x=()=>{o.value&&o.value.resize()};return D([()=>e.metrics,()=>e.startTime,()=>e.endTime,()=>e.interval,()=>e.refreshTrigger,()=>e.selectedNode],()=>{F()}),D(()=>e.startTime,n=>{n!==i.value&&(i.value=n)}),D(()=>e.interval,n=>{n!==a.value&&(a.value=n)}),D(()=>e.refreshInterval,n=>{g&&(clearInterval(g),g=null),n>0&&(g=window.setInterval(()=>{F()},n))}),V(()=>{w(),F(),window.addEventListener("resize",x)}),R(()=>{g&&(clearInterval(g),g=null),o.value&&(o.value.dispose(),o.value=null),window.removeEventListener("resize",x)}),{chartRef:h,loading:N,selectedInterval:a,onIntervalChange:A,selectedTimeRange:i,onTimeRangeChange:C}}});const W={ref:"chartRef",class:"chart"};function G(e,t,h,o,N,b){const a=H,i=k,w=z,E=L;return $(),B(E,{title:e.title},{extra:u(()=>[r(w,null,{default:u(()=>[r(i,{modelValue:e.selectedTimeRange,"onUpdate:modelValue":t[0]||(t[0]=C=>e.selectedTimeRange=C),style:{width:"100px"},onChange:e.onTimeRangeChange},{default:u(()=>[r(a,{value:"-15m"},{default:u(()=>t[2]||(t[2]=[s("15\u5206\u949F")])),_:1}),r(a,{value:"-30m"},{default:u(()=>t[3]||(t[3]=[s("30\u5206\u949F")])),_:1}),r(a,{value:"-1h"},{default:u(()=>t[4]||(t[4]=[s("1\u5C0F\u65F6")])),_:1}),r(a,{value:"-3h"},{default:u(()=>t[5]||(t[5]=[s("3\u5C0F\u65F6")])),_:1}),r(a,{value:"-6h"},{default:u(()=>t[6]||(t[6]=[s("6\u5C0F\u65F6")])),_:1}),r(a,{value:"-12h"},{default:u(()=>t[7]||(t[7]=[s("12\u5C0F\u65F6")])),_:1}),r(a,{value:"-1d"},{default:u(()=>t[8]||(t[8]=[s("1\u5929")])),_:1}),r(a,{value:"-7d"},{default:u(()=>t[9]||(t[9]=[s("7\u5929")])),_:1})]),_:1},8,["modelValue","onChange"]),r(i,{modelValue:e.selectedInterval,"onUpdate:modelValue":t[1]||(t[1]=C=>e.selectedInterval=C),style:{width:"90px"},onChange:e.onIntervalChange},{default:u(()=>[r(a,{value:"10s"},{default:u(()=>t[10]||(t[10]=[s("10\u79D2")])),_:1}),r(a,{value:"30s"},{default:u(()=>t[11]||(t[11]=[s("30\u79D2")])),_:1}),r(a,{value:"1m"},{default:u(()=>t[12]||(t[12]=[s("1\u5206\u949F")])),_:1}),r(a,{value:"5m"},{default:u(()=>t[13]||(t[13]=[s("5\u5206\u949F")])),_:1}),r(a,{value:"15m"},{default:u(()=>t[14]||(t[14]=[s("15\u5206\u949F")])),_:1}),r(a,{value:"30m"},{default:u(()=>t[15]||(t[15]=[s("30\u5206\u949F")])),_:1}),r(a,{value:"1h"},{default:u(()=>t[16]||(t[16]=[s("1\u5C0F\u65F6")])),_:1})]),_:1},8,["modelValue","onChange"])]),_:1})]),default:u(()=>[q("div",W,null,512)]),_:1},8,["title"])}const te=_(j,[["render",G],["__scopeId","data-v-8cdcd2c4"]]);export{te as M};
