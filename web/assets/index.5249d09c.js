import{t as G,_ as J}from"./index.15381f0b.js";/* empty css              *//* empty css              *//* empty css               *//* empty css                *//* empty css              */import{d as K,j as b,o as L,b as X,C as m,D as y,aI as r,aH as o,E as s,aM as u,u as Q,aN as l,aK as S,aJ as $,aE as x,F as O,aF as R,aX as z,bT as W,bU as Z,aY as tt,bc as et,ba as st,bl as at,ca as ot,bY as rt,bS as ut,bO as lt,bP as nt}from"./arco.2804d378.js";import{f as it}from"./vue.bbad6851.js";import{g as dt}from"./monitor.07efdc4f.js";import{l as ct}from"./distributed.0f0884be.js";import"./chart.100020e2.js";const mt={class:"container"},_t={class:"environment-settings"},pt={class:"node-title"},ft={class:"node-info"},vt={class:"info-row"},yt={class:"info-col"},gt={class:"info-col"},ht={key:0,class:"system-metrics"},bt={class:"metrics-row"},kt={class:"metric-item"},Ft={class:"metric-label"},Dt={class:"metric-item"},Bt={class:"metric-label"},wt={class:"metric-item"},Et={class:"metric-label"},Ct={key:1,class:"no-data"},xt={class:"node-actions"},It={class:"service-title"},At={class:"service-info"},Ht={class:"info-item"},St={class:"info-value"},$t={key:0,class:"service-nodes"},Nt={class:"nodes-list"},Pt={class:"service-actions"},Tt=K({__name:"index",setup(Vt){const N=it(),k=b(!1),I=b("30000"),p=b(null),F=b([]),A=b([]),H=b([]);async function P(){k.value=!0;try{const a=await ct();if(a.data){const t=new Map;Object.entries(a.data).forEach(([c,d])=>{var w,f;if(!Array.isArray(d))return;const _={id:c,name:c,isHealthy:!0,nodeCount:d.length,description:(f=(w=d[0])==null?void 0:w.metadata)==null?void 0:f.description,nodes:d.map(n=>{var E,v,D,B,e;return{id:n.id,name:((E=n.metadata)==null?void 0:E.name)||n.name,address:n.address,port:((v=n.metadata)==null?void 0:v.http_port)||((D=n.metadata)==null?void 0:D.grpc_port),apiAddress:`http://${n.address}:${((B=n.metadata)==null?void 0:B.http_port)||((e=n.metadata)==null?void 0:e.grpc_port)}`,isHealthy:!0,metadata:n.metadata}}),metadata:{memberCount:d.length}};t.set(c,_)}),F.value=Array.from(t.values());const i=F.value.find(c=>c.name==="aio-service");i&&(A.value=i.nodes),H.value=F.value.filter(c=>c.name!=="aio-service"),U()}}catch(a){console.error("\u83B7\u53D6\u670D\u52A1\u5217\u8868\u5931\u8D25:",a),z.error("\u83B7\u53D6\u670D\u52A1\u5217\u8868\u5931\u8D25")}finally{k.value=!1}}async function U(){var a;for(const t of A.value)try{if(!t.apiAddress)continue;const i=t.apiAddress.match(/http:\/\/([^:]+):(\d+)/);if(!i)continue;const c=i[1],d=await dt(c,(a=t.metadata)==null?void 0:a.http_port);if(d&&d.data){const _=d.data;t.systemInfo={cpu_usage:_.cpu_usage||0,memory_usage:_.memory_usage||0,disk_usage:_.disk_usage||0,load_average:_.load_average||[0,0,0],uptime:_.uptime||0,boot_time:_.boot_time||0},t.isHealthy=!0}}catch(i){console.error(`\u83B7\u53D6\u8282\u70B9 ${t.id} \u7CFB\u7EDF\u6982\u89C8\u5931\u8D25:`,i),t.isHealthy=!1}j()}function j(){F.value.forEach(a=>{a.isHealthy=a.nodes.some(t=>t.isHealthy)}),H.value=F.value.filter(a=>a.name!=="aio-service")}async function T(){k.value=!0;try{await P()}catch(a){console.error("\u5237\u65B0\u6570\u636E\u5931\u8D25:",a),z.error("\u5237\u65B0\u6570\u636E\u5931\u8D25")}finally{k.value=!1}}function V(){p.value&&(clearInterval(p.value),p.value=null);const a=parseInt(I.value);a>0&&(p.value=window.setInterval(()=>{T()},a))}function Y(a){N.push({path:"/monitor",query:{nodeId:a.id}})}function q(a){N.push(`/monitor/service-detail/${a.name}`)}function g(a){return a>=80?"#F53F3F":a>=60?"#FF7D00":"#00B42A"}return L(async()=>{P(),V()}),X(()=>{p.value&&(clearInterval(p.value),p.value=null)}),(a,t)=>{const i=W,c=Z,d=tt,_=et,w=st,f=at,n=ot,E=rt,v=ut,D=lt,B=nt;return m(),y("div",mt,[r(v,{class:"overview-card",title:"AIO\u670D\u52A1\u8282\u70B9"},{extra:o(()=>[s("div",_t,[r(w,{size:"large"},{default:o(()=>[r(_,{label:a.$t("workplace.environment.autoRefresh"),class:"no-margin"},{default:o(()=>[r(c,{modelValue:I.value,"onUpdate:modelValue":t[0]||(t[0]=e=>I.value=e),style:{width:"120px"},onChange:V},{default:o(()=>[r(i,{value:"0"},{default:o(()=>t[1]||(t[1]=[u("\u4E0D\u81EA\u52A8\u5237\u65B0")])),_:1}),r(i,{value:"10000"},{default:o(()=>t[2]||(t[2]=[u("10\u79D2")])),_:1}),r(i,{value:"30000"},{default:o(()=>t[3]||(t[3]=[u("30\u79D2")])),_:1}),r(i,{value:"60000"},{default:o(()=>t[4]||(t[4]=[u("1\u5206\u949F")])),_:1}),r(i,{value:"300000"},{default:o(()=>t[5]||(t[5]=[u("5\u5206\u949F")])),_:1})]),_:1},8,["modelValue"]),r(d,{type:"text",onClick:T},{icon:o(()=>[r(Q(G),{loading:k.value},null,8,["loading"])]),default:o(()=>[u(" "+l(a.$t("workplace.environment.refreshNow")),1)]),_:1})]),_:1},8,["label"])]),_:1})])]),default:o(()=>[r(B,{gutter:[16,16]},{default:o(()=>[(m(!0),y(S,null,$(A.value,e=>(m(),x(D,{key:e.id,span:8,xs:24,sm:12,md:8},{default:o(()=>[r(v,{class:O(["node-card",{"node-card-error":!e.isHealthy}])},{title:o(()=>[s("div",pt,[s("div",null,[s("span",null,l(e.id||"\u672A\u547D\u540D\u8282\u70B9"),1)]),r(f,{color:e.isHealthy?"green":"red"},{default:o(()=>[u(l(e.isHealthy?"\u6B63\u5E38":"\u5F02\u5E38"),1)]),_:2},1032,["color"])])]),default:o(()=>{var h,C,M;return[s("div",ft,[s("div",vt,[s("div",yt,[s("p",null,[t[6]||(t[6]=s("strong",null,"\u5185\u7F51\u5730\u5740:",-1)),u(" "+l(e.address||"-"),1)]),s("p",null,[t[7]||(t[7]=s("strong",null,"\u516C\u7F51\u5730\u5740:",-1)),u(" "+l(((h=e.metadata)==null?void 0:h.public_ip)||"-"),1)])]),s("div",gt,[s("p",null,[t[8]||(t[8]=s("strong",null,"GRPC\u7AEF\u53E3:",-1)),u(" "+l(((C=e.metadata)==null?void 0:C.grpc_port)||"-"),1)]),s("p",null,[t[9]||(t[9]=s("strong",null,"HTTP\u7AEF\u53E3:",-1)),u(" "+l(((M=e.metadata)==null?void 0:M.http_port)||"-"),1)])])]),e.systemInfo?(m(),y("div",ht,[s("div",bt,[s("div",kt,[r(n,{type:"circle",percent:parseFloat((e.systemInfo.cpu_usage/100).toFixed(2)),"stroke-color":g(e.systemInfo.cpu_usage),"show-text":!0,status:"normal",width:80,color:g(e.systemInfo.cpu_usage),"track-color":"rgba(var(--gray-3), 0.3)"},null,8,["percent","stroke-color","color"]),s("div",Ft,"CPU: "+l(e.systemInfo.cpu_usage.toFixed(1))+"%",1)]),s("div",Dt,[r(n,{type:"circle",percent:parseFloat((e.systemInfo.memory_usage/100).toFixed(2)),"stroke-color":g(e.systemInfo.memory_usage),"show-text":!0,status:"normal",width:80,color:g(e.systemInfo.memory_usage),"track-color":"rgba(var(--gray-3), 0.3)"},null,8,["percent","stroke-color","color"]),s("div",Bt,"\u5185\u5B58: "+l(e.systemInfo.memory_usage.toFixed(1))+"%",1)]),s("div",wt,[r(n,{type:"circle",percent:parseFloat((e.systemInfo.disk_usage/100).toFixed(2)),"stroke-color":g(e.systemInfo.disk_usage),"show-text":!0,status:"normal",width:80,color:g(e.systemInfo.disk_usage),"track-color":"rgba(var(--gray-3), 0.3)"},null,8,["percent","stroke-color","color"]),s("div",Et,"\u78C1\u76D8: "+l(e.systemInfo.disk_usage.toFixed(1))+"%",1)])])])):(m(),y("div",Ct,[r(E,{description:"\u6682\u65E0\u7CFB\u7EDF\u6570\u636E"})])),s("div",xt,[r(d,{type:"primary",size:"small",onClick:Mt=>Y(e)},{default:o(()=>t[10]||(t[10]=[u(" \u67E5\u770B\u76D1\u63A7 ")])),_:2},1032,["onClick"])])])]}),_:2},1032,["class"])]),_:2},1024))),128))]),_:1})]),_:1}),r(v,{class:"overview-card",title:"\u670D\u52A1\u53D1\u73B0"},{default:o(()=>[r(B,{gutter:[16,16]},{default:o(()=>[(m(!0),y(S,null,$(H.value,e=>(m(),x(D,{key:e.name,span:8,xs:24,sm:12,md:8},{default:o(()=>[r(v,{class:O(["service-card",{"service-card-error":!e.isHealthy}])},{title:o(()=>[s("div",It,[s("span",null,l(e.name),1),r(f,{color:e.isHealthy?"green":"red"},{default:o(()=>[u(l(e.isHealthy?"\u6B63\u5E38":"\u5F02\u5E38"),1)]),_:2},1032,["color"])])]),default:o(()=>[s("div",At,[s("div",Ht,[t[11]||(t[11]=s("span",{class:"info-label"},"\u8282\u70B9\u6570:",-1)),s("span",St,l(e.nodeCount),1)]),e.nodes&&e.nodes.length>0?(m(),y("div",$t,[t[12]||(t[12]=s("div",{class:"nodes-header"},"\u8282\u70B9\u5217\u8868",-1)),s("div",Nt,[(m(!0),y(S,null,$(e.nodes.slice(0,3),(h,C)=>(m(),x(f,{key:C,color:"blue",style:{"margin-bottom":"8px"}},{default:o(()=>[u(l(h.address)+":"+l(h.port),1)]),_:2},1024))),128)),e.nodes.length>3?(m(),x(f,{key:0,color:"gray"},{default:o(()=>[u("+"+l(e.nodes.length-3)+"\u4E2A\u8282\u70B9",1)]),_:2},1024)):R("",!0)])])):R("",!0),s("div",Pt,[r(d,{type:"primary",size:"small",onClick:h=>q(e)},{default:o(()=>t[13]||(t[13]=[u(" \u67E5\u770B\u8BE6\u60C5 ")])),_:2},1032,["onClick"])])])]),_:2},1032,["class"])]),_:2},1024))),128))]),_:1})]),_:1})])}}});const Xt=J(Tt,[["__scopeId","data-v-9925bb1b"]]);export{Xt as default};
