import{t as G,_ as J}from"./index.a81c3a0f.js";/* empty css              *//* empty css              *//* empty css                *//* empty css               *//* empty css                *//* empty css              */import{d as K,j as b,o as L,b as X,C as m,D as y,aI as r,aH as a,E as s,aM as u,u as O,aN as l,aK as S,aJ as N,aE as x,F as R,aF as z,aX as U,bT as Q,bU as W,aY as Z,bc as tt,ba as et,bl as st,ca as at,bY as ot,bS as rt,bO as ut,bP as lt}from"./arco.2804d378.js";import{f as nt}from"./vue.bbad6851.js";import{g as it}from"./monitor.50aeaf0e.js";import{g as dt}from"./distributed.c36fd468.js";import"./chart.9f128c58.js";const ct={class:"container"},mt={class:"environment-settings"},_t={class:"node-title"},pt={class:"node-info"},ft={class:"info-row"},vt={class:"info-col"},yt={class:"info-col"},gt={key:0,class:"system-metrics"},ht={class:"metrics-row"},bt={class:"metric-item"},kt={class:"metric-label"},Ft={class:"metric-item"},Dt={class:"metric-label"},Bt={class:"metric-item"},wt={class:"metric-label"},Et={key:1,class:"no-data"},Ct={class:"node-actions"},xt={class:"service-title"},At={class:"service-info"},It={class:"info-item"},Ht={class:"info-value"},St={key:0,class:"service-nodes"},Nt={class:"nodes-list"},Pt={class:"service-actions"},Tt=K({__name:"index",setup(Vt){const P=nt(),k=b(!1),A=b("30000"),p=b(null),F=b([]),I=b([]),H=b([]);async function T(){k.value=!0;try{const o=await dt();if(o.data){const t=new Map;Object.entries(o.data).forEach(([c,d])=>{var w,f;if(!Array.isArray(d))return;const _={id:c,name:c,isHealthy:!0,nodeCount:d.length,description:(f=(w=d[0])==null?void 0:w.metadata)==null?void 0:f.description,nodes:d.map(n=>{var E,v,D,B,e;return{id:n.id,name:((E=n.metadata)==null?void 0:E.name)||n.name,address:n.address,port:((v=n.metadata)==null?void 0:v.http_port)||((D=n.metadata)==null?void 0:D.grpc_port),apiAddress:`http://${n.address}:${((B=n.metadata)==null?void 0:B.http_port)||((e=n.metadata)==null?void 0:e.grpc_port)}`,isHealthy:!0,metadata:n.metadata}}),metadata:{memberCount:d.length}};t.set(c,_)}),F.value=Array.from(t.values());const i=F.value.find(c=>c.name==="aio-service");i&&(I.value=i.nodes),H.value=F.value.filter(c=>c.name!=="aio-service"),j()}}catch(o){console.error("\u83B7\u53D6\u670D\u52A1\u5217\u8868\u5931\u8D25:",o),U.error("\u83B7\u53D6\u670D\u52A1\u5217\u8868\u5931\u8D25")}finally{k.value=!1}}async function j(){var o;for(const t of I.value)try{if(!t.apiAddress)continue;const i=t.apiAddress.match(/http:\/\/([^:]+):(\d+)/);if(!i)continue;const c=i[1],d=await it(c,(o=t.metadata)==null?void 0:o.http_port);if(d&&d.data){const _=d.data;t.systemInfo={cpu_usage:_.cpu_usage||0,memory_usage:_.memory_usage||0,disk_usage:_.disk_usage||0,load_average:_.load_average||[0,0,0],uptime:_.uptime||0,boot_time:_.boot_time||0},t.isHealthy=!0}}catch(i){console.error(`\u83B7\u53D6\u8282\u70B9 ${t.id} \u7CFB\u7EDF\u6982\u89C8\u5931\u8D25:`,i),t.isHealthy=!1}Y()}function Y(){F.value.forEach(o=>{o.isHealthy=o.nodes.some(t=>t.isHealthy)}),H.value=F.value.filter(o=>o.name!=="aio-service")}async function V(){k.value=!0;try{await T()}catch(o){console.error("\u5237\u65B0\u6570\u636E\u5931\u8D25:",o),U.error("\u5237\u65B0\u6570\u636E\u5931\u8D25")}finally{k.value=!1}}function $(){p.value&&(clearInterval(p.value),p.value=null);const o=parseInt(A.value);o>0&&(p.value=window.setInterval(()=>{V()},o))}function q(o){P.push({path:"/monitor-overview",query:{nodeId:o.id}})}function g(o){return o>=80?"#F53F3F":o>=60?"#FF7D00":"#00B42A"}return L(async()=>{T(),$()}),X(()=>{p.value&&(clearInterval(p.value),p.value=null)}),(o,t)=>{const i=Q,c=W,d=Z,_=tt,w=et,f=st,n=at,E=ot,v=rt,D=ut,B=lt;return m(),y("div",ct,[r(v,{class:"overview-card",title:"AIO\u670D\u52A1\u8282\u70B9"},{extra:a(()=>[s("div",mt,[r(w,{size:"large"},{default:a(()=>[r(_,{label:o.$t("workplace.environment.autoRefresh"),class:"no-margin"},{default:a(()=>[r(c,{modelValue:A.value,"onUpdate:modelValue":t[0]||(t[0]=e=>A.value=e),style:{width:"120px"},onChange:$},{default:a(()=>[r(i,{value:"0"},{default:a(()=>t[2]||(t[2]=[u("\u4E0D\u81EA\u52A8\u5237\u65B0")])),_:1}),r(i,{value:"10000"},{default:a(()=>t[3]||(t[3]=[u("10\u79D2")])),_:1}),r(i,{value:"30000"},{default:a(()=>t[4]||(t[4]=[u("30\u79D2")])),_:1}),r(i,{value:"60000"},{default:a(()=>t[5]||(t[5]=[u("1\u5206\u949F")])),_:1}),r(i,{value:"300000"},{default:a(()=>t[6]||(t[6]=[u("5\u5206\u949F")])),_:1})]),_:1},8,["modelValue"]),r(d,{type:"text",onClick:V},{icon:a(()=>[r(O(G),{loading:k.value},null,8,["loading"])]),default:a(()=>[u(" "+l(o.$t("workplace.environment.refreshNow")),1)]),_:1})]),_:1},8,["label"])]),_:1})])]),default:a(()=>[r(B,{gutter:[16,16]},{default:a(()=>[(m(!0),y(S,null,N(I.value,e=>(m(),x(D,{key:e.id,span:8,xs:24,sm:12,md:8},{default:a(()=>[r(v,{class:R(["node-card",{"node-card-error":!e.isHealthy}])},{title:a(()=>[s("div",_t,[s("div",null,[s("span",null,l(e.id||"\u672A\u547D\u540D\u8282\u70B9"),1)]),r(f,{color:e.isHealthy?"green":"red"},{default:a(()=>[u(l(e.isHealthy?"\u6B63\u5E38":"\u5F02\u5E38"),1)]),_:2},1032,["color"])])]),default:a(()=>{var h,C,M;return[s("div",pt,[s("div",ft,[s("div",vt,[s("p",null,[t[7]||(t[7]=s("strong",null,"\u5185\u7F51\u5730\u5740:",-1)),u(" "+l(e.address||"-"),1)]),s("p",null,[t[8]||(t[8]=s("strong",null,"\u516C\u7F51\u5730\u5740:",-1)),u(" "+l(((h=e.metadata)==null?void 0:h.public_ip)||"-"),1)])]),s("div",yt,[s("p",null,[t[9]||(t[9]=s("strong",null,"GRPC\u7AEF\u53E3:",-1)),u(" "+l(((C=e.metadata)==null?void 0:C.grpc_port)||"-"),1)]),s("p",null,[t[10]||(t[10]=s("strong",null,"HTTP\u7AEF\u53E3:",-1)),u(" "+l(((M=e.metadata)==null?void 0:M.http_port)||"-"),1)])])]),e.systemInfo?(m(),y("div",gt,[s("div",ht,[s("div",bt,[r(n,{type:"circle",percent:parseFloat((e.systemInfo.cpu_usage/100).toFixed(2)),"stroke-color":g(e.systemInfo.cpu_usage),"show-text":!0,status:"normal",width:80,color:g(e.systemInfo.cpu_usage),"track-color":"rgba(var(--gray-3), 0.3)"},null,8,["percent","stroke-color","color"]),s("div",kt,"CPU: "+l(e.systemInfo.cpu_usage.toFixed(1))+"%",1)]),s("div",Ft,[r(n,{type:"circle",percent:parseFloat((e.systemInfo.memory_usage/100).toFixed(2)),"stroke-color":g(e.systemInfo.memory_usage),"show-text":!0,status:"normal",width:80,color:g(e.systemInfo.memory_usage),"track-color":"rgba(var(--gray-3), 0.3)"},null,8,["percent","stroke-color","color"]),s("div",Dt,"\u5185\u5B58: "+l(e.systemInfo.memory_usage.toFixed(1))+"%",1)]),s("div",Bt,[r(n,{type:"circle",percent:parseFloat((e.systemInfo.disk_usage/100).toFixed(2)),"stroke-color":g(e.systemInfo.disk_usage),"show-text":!0,status:"normal",width:80,color:g(e.systemInfo.disk_usage),"track-color":"rgba(var(--gray-3), 0.3)"},null,8,["percent","stroke-color","color"]),s("div",wt,"\u78C1\u76D8: "+l(e.systemInfo.disk_usage.toFixed(1))+"%",1)])])])):(m(),y("div",Et,[r(E,{description:"\u6682\u65E0\u7CFB\u7EDF\u6570\u636E"})])),s("div",Ct,[r(d,{type:"primary",size:"small",onClick:$t=>q(e)},{default:a(()=>t[11]||(t[11]=[u(" \u67E5\u770B\u76D1\u63A7 ")])),_:2},1032,["onClick"])])])]}),_:2},1032,["class"])]),_:2},1024))),128))]),_:1})]),_:1}),r(v,{class:"overview-card",title:"\u670D\u52A1\u53D1\u73B0"},{default:a(()=>[r(B,{gutter:[16,16]},{default:a(()=>[(m(!0),y(S,null,N(H.value,e=>(m(),x(D,{key:e.name,span:8,xs:24,sm:12,md:8},{default:a(()=>[r(v,{class:R(["service-card",{"service-card-error":!e.isHealthy}])},{title:a(()=>[s("div",xt,[s("span",null,l(e.name),1),r(f,{color:e.isHealthy?"green":"red"},{default:a(()=>[u(l(e.isHealthy?"\u6B63\u5E38":"\u5F02\u5E38"),1)]),_:2},1032,["color"])])]),default:a(()=>[s("div",At,[s("div",It,[t[12]||(t[12]=s("span",{class:"info-label"},"\u8282\u70B9\u6570:",-1)),s("span",Ht,l(e.nodeCount),1)]),e.nodes&&e.nodes.length>0?(m(),y("div",St,[t[13]||(t[13]=s("div",{class:"nodes-header"},"\u8282\u70B9\u5217\u8868",-1)),s("div",Nt,[(m(!0),y(S,null,N(e.nodes.slice(0,3),(h,C)=>(m(),x(f,{key:C,color:"blue",style:{"margin-bottom":"8px"}},{default:a(()=>[u(l(h.address)+":"+l(h.port),1)]),_:2},1024))),128)),e.nodes.length>3?(m(),x(f,{key:0,color:"gray"},{default:a(()=>[u("+"+l(e.nodes.length-3)+"\u4E2A\u8282\u70B9",1)]),_:2},1024)):z("",!0)])])):z("",!0),s("div",Pt,[r(d,{type:"primary",size:"small",onClick:t[1]||(t[1]=h=>O(P).push("/distributed/serviceDiscovery"))},{default:a(()=>t[14]||(t[14]=[u(" \u67E5\u770B\u8282\u70B9 ")])),_:1})])])]),_:2},1032,["class"])]),_:2},1024))),128))]),_:1})]),_:1})])}}});const Xt=J(Tt,[["__scopeId","data-v-3baf1fb8"]]);export{Xt as default};
