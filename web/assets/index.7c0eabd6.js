import{_ as K,t as Q}from"./index.a81c3a0f.js";/* empty css               *//* empty css              *//* empty css               *//* empty css              *//* empty css                */import{d as Z,j as _,w as z,o as x,bF as le,aX as v,C as k,aE as q,aH as l,aI as t,aM as r,E as B,G as H,aN as y,D as U,aF as j,c9 as ke,ca as Ve,bO as ee,bP as ue,bS as ve,c as te,aT as Fe,aK as L,aJ as J,bT as ae,cb as Ne,bU as re,bc as se,ac as $e,aY as oe,ba as ie,bb as de,bQ as fe,bl as me,bX as ne,c1 as ge,bR as pe,b_ as ye,b2 as ce,r as be,a6 as Ee,aW as De,b7 as Be,b$ as Ie,c0 as Te,aV as _e,b1 as X,bv as Me,bs as Se}from"./arco.2804d378.js";import{h as Ue}from"./vue.bbad6851.js";/* empty css               *//* empty css                *//* empty css                */import{g as Pe,a as Re,m as he,b as Ce,c as Le,d as Ae,s as Oe,r as ze,e as We,f as we,u as qe,h as je,i as Ye,t as He,j as Je,k as Ge,l as Xe,n as Ke,o as Qe}from"./monitor.50aeaf0e.js";import{M as Ze}from"./MetricChart.c9d29e94.js";/* empty css                *//* empty css               *//* empty css               *//* empty css                *//* empty css              */import{d as xe}from"./distributed.c36fd468.js";import"./chart.9f128c58.js";const eu=Z({name:"SystemOverview",props:{refreshInterval:{type:Number,default:3e4},refreshTrigger:{type:Number,default:0},selectedNode:{type:Object,default:null}},setup(e){const u=_({cpu_usage:0,memory_usage:0,disk_usage:0,load_average:[0],uptime:0,boot_time:0}),I=_(!1),M=f=>Math.abs(f-Math.round(f))<.1?Math.round(f):Number(f.toFixed(1)),C=f=>{const p=Math.max(0,Math.min(100,f));return Number((p/100).toFixed(2))},R=f=>f<70?"normal":f<90?"warning":"danger",c=f=>{if(!u.value.load_average||u.value.load_average.length<=f)return"0.00";const p=u.value.load_average[f];return typeof p=="number"?p.toFixed(2):"0.00"},F=f=>{if(!u.value.load_average||u.value.load_average.length<=f)return"var(--color-text-1)";const p=u.value.load_average[f];return typeof p!="number"?"var(--color-text-1)":p<2?"var(--color-success-6)":p<4?"var(--color-warning-6)":"var(--color-danger-6)"},a=f=>{if(!u.value.load_average||u.value.load_average.length<=f)return 0;const p=u.value.load_average[f];if(typeof p!="number")return 0;const g=Math.min(p/8*100,100);return Math.round(g)},w=f=>{if(!u.value.load_average||u.value.load_average.length<=f)return"var(--color-fill-2)";const p=u.value.load_average[f];return typeof p!="number"?"var(--color-fill-2)":p<2?"var(--color-success-6)":p<4?"var(--color-warning-6)":"var(--color-danger-6)"},E=async()=>{var f,p;I.value=!0;try{let g;if(e.selectedNode){let b=e.selectedNode.address;b.includes(":")&&(b=b.split(":")[0]),g=await Pe(b,((f=e.selectedNode.metadata)==null?void 0:f.http_port)||0)}else g=await Re();if(g&&g.data){const b=g.data;u.value=b}}catch(g){console.error("\u83B7\u53D6\u7CFB\u7EDF\u6982\u89C8\u6570\u636E\u5931\u8D25:",g);const b=e.selectedNode?`(\u8282\u70B9: ${e.selectedNode.address.includes(":")?e.selectedNode.address.split(":")[0]:e.selectedNode.address}:${(p=e.selectedNode.metadata)==null?void 0:p.http_port})`:"";v.error(`\u83B7\u53D6\u7CFB\u7EDF\u6982\u89C8\u6570\u636E\u5931\u8D25${b}`)}finally{I.value=!1}};let h=null;return z(()=>e.selectedNode,()=>{E()}),z(()=>e.refreshTrigger,()=>{E()}),z(()=>e.refreshInterval,f=>{h&&(clearInterval(h),h=null),f>0&&(h=window.setInterval(()=>{E()},f))}),x(()=>{E(),e.refreshInterval>0&&(h=window.setInterval(()=>{E()},e.refreshInterval))}),le(()=>{h&&(clearInterval(h),h=null)}),{data:u,loading:I,formatPercent:M,formatProgressPercent:C,getStatusByPercent:R,formatLoad:c,getLoadColor:F,getLoadPercentage:a,getLoadProgressColor:w}}});const uu={class:"load-average-container"},tu={class:"load-item"},lu={class:"load-progress-container"},au={key:0,class:"load-item"},ru={class:"load-progress-container"},ou={key:1,class:"load-item"},nu={class:"load-progress-container"};function su(e,u,I,M,C,R){const c=ke,F=Ve,a=ee,w=ue,E=ve;return k(),q(E,{class:"general-card",title:e.$t("\u7CFB\u7EDF\u6982\u89C8")},{default:l(()=>[t(w,{gutter:16},{default:l(()=>[t(a,{span:6},{default:l(()=>[t(c,{title:"CPU\u4F7F\u7528\u7387",value:e.formatPercent(e.data.cpu_usage),loading:e.loading},{suffix:l(()=>u[0]||(u[0]=[r("%")])),_:1},8,["value","loading"]),t(F,{percent:e.formatProgressPercent(e.data.cpu_usage),status:e.getStatusByPercent(e.data.cpu_usage)},null,8,["percent","status"])]),_:1}),t(a,{span:6},{default:l(()=>[t(c,{title:"\u5185\u5B58\u4F7F\u7528\u7387",value:e.formatPercent(e.data.memory_usage),loading:e.loading},{suffix:l(()=>u[1]||(u[1]=[r("%")])),_:1},8,["value","loading"]),t(F,{percent:e.formatProgressPercent(e.data.memory_usage),status:e.getStatusByPercent(e.data.memory_usage)},null,8,["percent","status"])]),_:1}),t(a,{span:6},{default:l(()=>[t(c,{title:"\u78C1\u76D8\u4F7F\u7528\u7387",value:e.formatPercent(e.data.disk_usage),loading:e.loading},{suffix:l(()=>u[2]||(u[2]=[r("%")])),_:1},8,["value","loading"]),t(F,{percent:e.formatProgressPercent(e.data.disk_usage),status:e.getStatusByPercent(e.data.disk_usage)},null,8,["percent","status"])]),_:1}),t(a,{span:6},{default:l(()=>[t(c,{title:"\u7CFB\u7EDF\u8D1F\u8F7D",loading:e.loading},{value:l(()=>[B("span",{class:"main-load-value",style:H({color:e.getLoadColor(0)})},y(e.formatLoad(0)),5)]),_:1},8,["loading"]),B("div",uu,[B("div",tu,[B("span",{class:"load-value",style:H({color:e.getLoadColor(0)})},y(e.formatLoad(0)),5),u[3]||(u[3]=B("span",{class:"load-label"},"1\u5206\u949F",-1)),B("div",lu,[B("div",{class:"load-progress-bar",style:H({width:`${e.getLoadPercentage(0)}%`,backgroundColor:e.getLoadProgressColor(0)})},null,4)])]),e.data.load_average&&e.data.load_average.length>1?(k(),U("div",au,[B("span",{class:"load-value",style:H({color:e.getLoadColor(1)})},y(e.formatLoad(1)),5),u[4]||(u[4]=B("span",{class:"load-label"},"5\u5206\u949F",-1)),B("div",ru,[B("div",{class:"load-progress-bar",style:H({width:`${e.getLoadPercentage(1)}%`,backgroundColor:e.getLoadProgressColor(1)})},null,4)])])):j("",!0),e.data.load_average&&e.data.load_average.length>2?(k(),U("div",ou,[B("span",{class:"load-value",style:H({color:e.getLoadColor(2)})},y(e.formatLoad(2)),5),u[5]||(u[5]=B("span",{class:"load-label"},"15\u5206\u949F",-1)),B("div",nu,[B("div",{class:"load-progress-bar",style:H({width:`${e.getLoadPercentage(2)}%`,backgroundColor:e.getLoadProgressColor(2)})},null,4)])])):j("",!0)])]),_:1})]),_:1})]),_:1},8,["title"])}const iu=K(eu,[["render",su],["__scopeId","data-v-c80996eb"]]),du=Z({name:"AlertTable",props:{refreshInterval:{type:Number,default:6e4},refreshTrigger:{type:Number,default:0}},setup(e){const u=_([]),I=_([]),M=_(!1),C=_({metric_name:"",severity:"",state:""}),R=_(),c=_(!1),F=_({duration:"2h",comment:"",alert_id:""}),a=_([]),w=_(!1),E=_({total:0,current:1,pageSize:10}),h=te(()=>{let n=[...a.value];C.value.metric_name&&(n=n.filter(G=>G.metric===C.value.metric_name)),C.value.severity&&(n=n.filter(G=>G.severity===C.value.severity)),C.value.state&&(n=n.filter(G=>G.state===C.value.state));const P=(E.value.current-1)*E.value.pageSize,Y=P+E.value.pageSize;return n.slice(P,Y)}),f=te(()=>{let n=[...a.value];return C.value.metric_name&&(n=n.filter(P=>P.metric===C.value.metric_name)),C.value.severity&&(n=n.filter(P=>P.severity===C.value.severity)),C.value.state&&(n=n.filter(P=>P.state===C.value.state)),n.length});z(f,n=>{E.value.total=n});const p=n=>{if(!n)return"-";const P=typeof n=="number"?new Date(n*1e3):new Date(n);return Fe(P).format("YYYY-MM-DD HH:mm:ss")},g=n=>{switch(n){case"critical":return"red";case"warning":return"orange";case"info":return"blue";default:return"gray"}},b=n=>{switch(n){case"critical":return"\u4E25\u91CD";case"warning":return"\u8B66\u544A";case"info":return"\u4FE1\u606F";default:return"\u672A\u77E5"}},$=n=>{switch(n){case"firing":return"red";case"silenced":return"gray";case"resolved":return"green";default:return"gray"}},T=n=>{switch(n){case"firing":return"\u89E6\u53D1\u4E2D";case"silenced":return"\u5DF2\u9759\u9ED8";case"resolved":return"\u5DF2\u89E3\u51B3";default:return"\u672A\u77E5"}},N=n=>{switch(n){case">":return">";case"<":return"<";case">=":return"\u2265";case"<=":return"\u2264";case"==":return"=";case"!=":return"\u2260";default:return n}},A=n=>he[n]||n,S=n=>Ce[n]||"",V=async()=>{w.value=!0;try{const n=await Le();n.data&&(a.value=n.data,E.value.total=a.value.length)}catch(n){console.error("\u83B7\u53D6\u544A\u8B66\u6570\u636E\u5931\u8D25:",n),v.error("\u83B7\u53D6\u544A\u8B66\u6570\u636E\u5931\u8D25")}finally{w.value=!1}},D=async()=>{M.value=!0;try{const n=await Ae();u.value=n.server_metrics,I.value=n.app_metrics}catch(n){console.error("\u83B7\u53D6\u6307\u6807\u5217\u8868\u5931\u8D25:",n),v.error("\u83B7\u53D6\u6307\u6807\u5217\u8868\u5931\u8D25")}finally{M.value=!1}},m=n=>{F.value.alert_id=n.id,c.value=!0},s=async()=>{var n;try{await R.value.validate();const P=await Oe(F.value.alert_id,{duration:F.value.duration,comment:F.value.comment});return P.data&&P.data.code===0?(v.success("\u544A\u8B66\u5DF2\u9759\u9ED8"),V(),!0):(v.error(`\u9759\u9ED8\u5931\u8D25: ${((n=P.data)==null?void 0:n.msg)||"\u672A\u77E5\u9519\u8BEF"}`),!1)}catch(P){return console.error("\u9759\u9ED8\u544A\u8B66\u5931\u8D25:",P),!1}},d=async n=>{var P;try{const Y=await ze(n.id);Y.data&&Y.data.code===0?(v.success("\u544A\u8B66\u5DF2\u89E3\u51B3"),V()):v.error(`\u89E3\u51B3\u5931\u8D25: ${((P=Y.data)==null?void 0:P.msg)||"\u672A\u77E5\u9519\u8BEF"}`)}catch(Y){console.error("\u89E3\u51B3\u544A\u8B66\u5931\u8D25:",Y),v.error("\u89E3\u51B3\u544A\u8B66\u5931\u8D25")}},O=()=>{E.value.current=1},W=()=>{C.value={metric_name:"",severity:"",state:""},E.value.current=1},i=n=>{E.value.current=n};let o=null;return z(()=>e.refreshTrigger,()=>{V()}),z(()=>e.refreshInterval,n=>{o&&(clearInterval(o),o=null),n>0&&(o=window.setInterval(()=>{V()},n))}),x(()=>{V(),D(),e.refreshInterval>0&&(o=window.setInterval(()=>{V()},e.refreshInterval))}),le(()=>{o&&(clearInterval(o),o=null)}),{searchForm:C,silenceFormRef:R,silenceFormVisible:c,silenceForm:F,alerts:a,loading:w,pagination:E,filteredData:h,formatDateTime:p,getSeverityColor:g,getSeverityText:b,getStateColor:$,getStateText:T,getConditionText:N,handleSilence:m,handleSubmitSilence:s,handleResolve:d,handleSearch:O,resetSearch:W,onPageChange:i,serverMetrics:u,appMetrics:I,metricsLoading:M,getMetricChineseName:A,getMetricUnit:S}}});const fu={style:{color:"#999","margin-left":"8px","font-size":"12px"}},mu={style:{color:"#999","margin-left":"8px","font-size":"12px"}},gu={style:{color:"#999","font-size":"12px"}};function pu(e,u,I,M,C,R){const c=ae,F=Ne,a=re,w=se,E=$e,h=oe,f=Q,p=ie,g=de,b=ee,$=ue,T=fe,N=me,A=ne,S=ge,V=pe,D=ye,m=ce;return k(),U("div",null,[t($,{style:{"margin-bottom":"16px"}},{default:l(()=>[t(b,{span:24},{default:l(()=>[t(g,{layout:"inline",model:e.searchForm,onSubmit:e.handleSearch},{default:l(()=>[t(w,{field:"metric_name",label:"\u6307\u6807\u540D\u79F0"},{default:l(()=>[t(a,{modelValue:e.searchForm.metric_name,"onUpdate:modelValue":u[0]||(u[0]=s=>e.searchForm.metric_name=s),placeholder:"\u8BF7\u9009\u62E9\u6307\u6807\u540D\u79F0","allow-clear":"",loading:e.metricsLoading},{default:l(()=>[t(F,{label:"\u670D\u52A1\u5668\u6307\u6807"},{default:l(()=>[(k(!0),U(L,null,J(e.serverMetrics,s=>(k(),q(c,{key:s,value:s,label:e.getMetricChineseName(s)},{default:l(()=>[r(y(e.getMetricChineseName(s))+" ",1),B("span",fu,"("+y(s)+")",1)]),_:2},1032,["value","label"]))),128))]),_:1}),t(F,{label:"\u5E94\u7528\u6307\u6807"},{default:l(()=>[(k(!0),U(L,null,J(e.appMetrics,s=>(k(),q(c,{key:s,value:s,label:e.getMetricChineseName(s)},{default:l(()=>[r(y(e.getMetricChineseName(s))+" ",1),B("span",mu,"("+y(s)+")",1)]),_:2},1032,["value","label"]))),128))]),_:1})]),_:1},8,["modelValue","loading"])]),_:1}),t(w,{field:"severity",label:"\u4E25\u91CD\u7A0B\u5EA6"},{default:l(()=>[t(a,{modelValue:e.searchForm.severity,"onUpdate:modelValue":u[1]||(u[1]=s=>e.searchForm.severity=s),placeholder:"\u8BF7\u9009\u62E9\u4E25\u91CD\u7A0B\u5EA6","allow-clear":""},{default:l(()=>[t(c,{value:"critical"},{default:l(()=>u[6]||(u[6]=[r("\u4E25\u91CD")])),_:1}),t(c,{value:"warning"},{default:l(()=>u[7]||(u[7]=[r("\u8B66\u544A")])),_:1}),t(c,{value:"info"},{default:l(()=>u[8]||(u[8]=[r("\u4FE1\u606F")])),_:1})]),_:1},8,["modelValue"])]),_:1}),t(w,{field:"state",label:"\u72B6\u6001"},{default:l(()=>[t(a,{modelValue:e.searchForm.state,"onUpdate:modelValue":u[2]||(u[2]=s=>e.searchForm.state=s),placeholder:"\u8BF7\u9009\u62E9\u72B6\u6001","allow-clear":""},{default:l(()=>[t(c,{value:"firing"},{default:l(()=>u[9]||(u[9]=[r("\u89E6\u53D1\u4E2D")])),_:1}),t(c,{value:"silenced"},{default:l(()=>u[10]||(u[10]=[r("\u5DF2\u9759\u9ED8")])),_:1})]),_:1},8,["modelValue"])]),_:1}),t(w,null,{default:l(()=>[t(p,null,{default:l(()=>[t(h,{type:"primary","html-type":"submit"},{icon:l(()=>[t(E)]),default:l(()=>[u[11]||(u[11]=r(" \u641C\u7D22 "))]),_:1}),t(h,{onClick:e.resetSearch},{icon:l(()=>[t(f)]),default:l(()=>[u[12]||(u[12]=r(" \u91CD\u7F6E "))]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["model","onSubmit"])]),_:1})]),_:1}),t(V,{data:e.filteredData,loading:e.loading,pagination:e.pagination,onPageChange:e.onPageChange},{columns:l(()=>[t(T,{title:"ID","data-index":"id",width:80}),t(T,{title:"\u89C4\u5219\u540D\u79F0","data-index":"rule_name"}),t(T,{title:"\u6307\u6807\u540D\u79F0",width:180},{cell:l(({record:s})=>[r(y(e.getMetricChineseName(s.metric))+" ",1),B("div",gu,y(s.metric),1)]),_:1}),t(T,{title:"\u5F53\u524D\u503C/\u9608\u503C",width:150},{cell:l(({record:s})=>[r(y(s.value)+y(e.getMetricUnit(s.metric))+" "+y(e.getConditionText(s.condition))+" "+y(s.threshold)+y(e.getMetricUnit(s.metric)),1)]),_:1}),t(T,{title:"\u4E25\u91CD\u7A0B\u5EA6","data-index":"severity",width:100},{cell:l(({record:s})=>[t(N,{color:e.getSeverityColor(s.severity)},{default:l(()=>[r(y(e.getSeverityText(s.severity)),1)]),_:2},1032,["color"])]),_:1}),t(T,{title:"\u72B6\u6001","data-index":"state",width:100},{cell:l(({record:s})=>[t(N,{color:e.getStateColor(s.state)},{default:l(()=>[r(y(e.getStateText(s.state)),1)]),_:2},1032,["color"])]),_:1}),t(T,{title:"\u5F00\u59CB\u65F6\u95F4","data-index":"starts_at",width:180},{cell:l(({record:s})=>[r(y(e.formatDateTime(s.starts_at)),1)]),_:1}),t(T,{title:"\u64CD\u4F5C",width:180},{cell:l(({record:s})=>[t(p,null,{default:l(()=>[t(h,{type:"text",size:"small",onClick:d=>e.handleSilence(s)},{default:l(()=>u[13]||(u[13]=[r(" \u9759\u9ED8 ")])),_:2},1032,["onClick"]),t(A,{style:{height:"16px"},direction:"vertical"}),t(S,{content:"\u786E\u5B9A\u8981\u89E3\u51B3\u8BE5\u544A\u8B66\u5417\uFF1F",onOk:d=>e.handleResolve(s)},{default:l(()=>[t(h,{type:"text",status:"success",size:"small"},{default:l(()=>u[14]||(u[14]=[r(" \u89E3\u51B3 ")])),_:1})]),_:2},1032,["onOk"])]),_:2},1024)]),_:1})]),_:1},8,["data","loading","pagination","onPageChange"]),t(m,{visible:e.silenceFormVisible,"onUpdate:visible":u[5]||(u[5]=s=>e.silenceFormVisible=s),title:"\u9759\u9ED8\u544A\u8B66",onBeforeOk:e.handleSubmitSilence},{default:l(()=>[t(g,{ref:"silenceFormRef",model:e.silenceForm},{default:l(()=>[t(w,{field:"duration",label:"\u6301\u7EED\u65F6\u95F4",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u6301\u7EED\u65F6\u95F4"}]},{default:l(()=>[t(a,{modelValue:e.silenceForm.duration,"onUpdate:modelValue":u[3]||(u[3]=s=>e.silenceForm.duration=s),placeholder:"\u8BF7\u9009\u62E9\u6301\u7EED\u65F6\u95F4"},{default:l(()=>[t(c,{value:"30m"},{default:l(()=>u[15]||(u[15]=[r("30\u5206\u949F")])),_:1}),t(c,{value:"1h"},{default:l(()=>u[16]||(u[16]=[r("1\u5C0F\u65F6")])),_:1}),t(c,{value:"2h"},{default:l(()=>u[17]||(u[17]=[r("2\u5C0F\u65F6")])),_:1}),t(c,{value:"6h"},{default:l(()=>u[18]||(u[18]=[r("6\u5C0F\u65F6")])),_:1}),t(c,{value:"12h"},{default:l(()=>u[19]||(u[19]=[r("12\u5C0F\u65F6")])),_:1}),t(c,{value:"1d"},{default:l(()=>u[20]||(u[20]=[r("1\u5929")])),_:1})]),_:1},8,["modelValue"])]),_:1}),t(w,{field:"comment",label:"\u5907\u6CE8",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u5907\u6CE8\u4FE1\u606F"}]},{default:l(()=>[t(D,{modelValue:e.silenceForm.comment,"onUpdate:modelValue":u[4]||(u[4]=s=>e.silenceForm.comment=s),placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8\u4FE1\u606F"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","onBeforeOk"])])}const cu=K(du,[["render",pu],["__scopeId","data-v-fa3e402b"]]),vu=Z({name:"AlertRules",props:{refreshInterval:{type:Number,default:6e4},refreshTrigger:{type:Number,default:0}},setup(e){const u=_([]),I=_([]),M=_(!1),C=_({total:0,current:1,pageSize:10}),R=_(),c=_(!1),F=_(!1),a=be({id:"",name:"",target_type:"server",metric:"",description:"",condition:"gt",threshold:0,duration:"0",severity:"warning",notifiers:[],enabled:!0}),w={name:[{required:!0,message:"\u8BF7\u8F93\u5165\u89C4\u5219\u540D\u79F0"}],target_type:[{required:!0,message:"\u8BF7\u9009\u62E9\u76EE\u6807\u7C7B\u578B"}],metric:[{required:!0,message:"\u8BF7\u8F93\u5165\u6307\u6807\u540D\u79F0"}],threshold:[{required:!0,message:"\u8BF7\u8F93\u5165\u9608\u503C"}]},E=_([]),h=_([]),f=_(!1),p=o=>{switch(o){case"critical":return"red";case"warning":return"orange";case"info":return"blue";default:return"gray"}},g=o=>{switch(o){case"critical":return"\u4E25\u91CD";case"warning":return"\u8B66\u544A";case"info":return"\u4FE1\u606F";default:return"\u672A\u77E5"}},b=o=>{switch(o){case"gt":return"\u5927\u4E8E";case"lt":return"\u5C0F\u4E8E";case"gte":return"\u5927\u4E8E\u7B49\u4E8E";case"lte":return"\u5C0F\u4E8E\u7B49\u4E8E";case"eq":return"\u7B49\u4E8E";case"neq":return"\u4E0D\u7B49\u4E8E";default:return o}},$=o=>{switch(o){case"email":return"\u90AE\u4EF6";case"webhook":return"Webhook";case"dingtalk":return"\u9489\u9489";case"wechat":return"\u5FAE\u4FE1";default:return o}},T=o=>{const n=I.value.find(P=>P.id===o);return n?n.name:o},N=async()=>{M.value=!0;try{const o=await We();o.data&&(u.value=o.data,C.value.total=u.value.length)}catch(o){console.error("\u83B7\u53D6\u544A\u8B66\u89C4\u5219\u5931\u8D25:",o),v.error("\u83B7\u53D6\u544A\u8B66\u89C4\u5219\u5931\u8D25")}finally{M.value=!1}try{const o=await we();o.data&&(I.value=o.data)}catch(o){console.error("\u83B7\u53D6\u901A\u77E5\u5668\u5931\u8D25:",o),v.error("\u83B7\u53D6\u901A\u77E5\u5668\u5931\u8D25")}},A=o=>{C.value.current=o},S=async()=>{f.value=!0;try{const o=await Ae();E.value=o.server_metrics,h.value=o.app_metrics}catch(o){console.error("\u83B7\u53D6\u6307\u6807\u5217\u8868\u5931\u8D25:",o),v.error("\u83B7\u53D6\u6307\u6807\u5217\u8868\u5931\u8D25")}finally{f.value=!1}},V=()=>{F.value=!1,a.id="",a.name="",a.target_type="server",a.metric="",a.description="",a.condition="gt",a.threshold=0,a.duration="5m",a.severity="warning",a.notifiers=[],a.enabled=!0,c.value=!0,E.value.length===0&&h.value.length===0&&S()},D=o=>{F.value=!0,a.id=o.id,a.name=o.name,a.target_type=o.target_type||"server",a.metric=o.metric,a.description=o.description||"",a.condition=o.condition,a.threshold=o.threshold,a.duration=o.duration||"0",a.severity=o.severity,a.notifiers=o.notifiers||[],a.enabled=o.enabled,c.value=!0},m=async()=>{try{await R.value.validate();const o={name:a.name,target_type:a.target_type,metric:a.metric,description:a.description,condition:a.condition,threshold:a.threshold,duration:a.duration,severity:a.severity,notifiers:a.notifiers,enabled:a.enabled};let n;if(F.value)if(n=await qe(a.id,o),n.data)v.success("\u89C4\u5219\u66F4\u65B0\u6210\u529F"),N();else return v.error("\u66F4\u65B0\u5931\u8D25: \u672A\u77E5\u9519\u8BEF"),!1;else if(n=await je(o),n.data)v.success("\u89C4\u5219\u521B\u5EFA\u6210\u529F"),N();else return v.error("\u521B\u5EFA\u5931\u8D25: \u672A\u77E5\u9519\u8BEF"),!1;return!0}catch(o){return console.error("\u8868\u5355\u9A8C\u8BC1\u5931\u8D25:",o),!1}},s=async o=>{try{(await Ye(o)).data?(v.success("\u89C4\u5219\u5220\u9664\u6210\u529F"),N()):v.error("\u5220\u9664\u5931\u8D25: \u672A\u77E5\u9519\u8BEF")}catch(n){console.error("\u5220\u9664\u89C4\u5219\u5931\u8D25:",n),v.error("\u5220\u9664\u89C4\u5219\u5931\u8D25")}},d=async o=>{try{(await He(o.id,{enabled:!o.enabled})).data?(v.success(`\u89C4\u5219${o.enabled?"\u7981\u7528":"\u542F\u7528"}\u6210\u529F`),N()):v.error("\u64CD\u4F5C\u5931\u8D25: \u672A\u77E5\u9519\u8BEF")}catch(n){console.error("\u5207\u6362\u89C4\u5219\u72B6\u6001\u5931\u8D25:",n),v.error("\u64CD\u4F5C\u5931\u8D25")}},O=o=>he[o]||o,W=o=>Ce[o]||"";z(()=>a.target_type,o=>{a.metric="",(o==="server"&&E.value.length===0||o==="application"&&h.value.length===0)&&S()});let i=null;return z(()=>e.refreshTrigger,()=>{N()}),z(()=>e.refreshInterval,o=>{i&&(clearInterval(i),i=null),o>0&&(i=window.setInterval(()=>{N()},o))}),x(()=>{N(),S(),e.refreshInterval>0&&(i=window.setInterval(()=>{N()},e.refreshInterval))}),le(()=>{i&&(clearInterval(i),i=null)}),{rules:u,notifiers:I,loading:M,pagination:C,ruleFormRef:R,ruleFormVisible:c,isEdit:F,ruleForm:a,ruleFormRules:w,getSeverityColor:p,getSeverityText:g,getConditionText:b,getNotifierTypeText:$,getNotifierName:T,fetchData:N,onPageChange:A,openAddRuleModal:V,openEditRuleModal:D,handleSubmitRule:m,deleteRule:s,toggleRule:d,serverMetrics:E,appMetrics:h,metricsLoading:f,getMetricChineseName:O,getMetricUnit:W}}}),Fu={style:{color:"#999","font-size":"12px"}},yu={style:{color:"#999","margin-left":"8px","font-size":"12px"}},bu={key:0},Eu={style:{"margin-left":"12px"}};function Du(e,u,I,M,C,R){const c=Ee,F=oe,a=Q,w=ie,E=ee,h=ue,f=fe,p=me,g=De,b=ne,$=ge,T=pe,N=Be,A=se,S=Ie,V=Te,D=ae,m=re,s=ye,d=_e,O=de,W=ce;return k(),U("div",null,[t(h,{style:{"margin-bottom":"16px"}},{default:l(()=>[t(E,{span:24},{default:l(()=>[t(w,null,{default:l(()=>[t(F,{type:"primary",onClick:e.openAddRuleModal},{icon:l(()=>[t(c)]),default:l(()=>[u[11]||(u[11]=r(" \u6DFB\u52A0\u89C4\u5219 "))]),_:1},8,["onClick"]),t(F,{onClick:e.fetchData},{icon:l(()=>[t(a)]),default:l(()=>[u[12]||(u[12]=r(" \u5237\u65B0 "))]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1}),t(T,{data:e.rules,loading:e.loading,pagination:e.pagination,onPageChange:e.onPageChange},{columns:l(()=>[t(f,{title:"ID","data-index":"id",width:80}),t(f,{title:"\u89C4\u5219\u540D\u79F0","data-index":"name"}),t(f,{title:"\u76EE\u6807\u7C7B\u578B",width:100},{cell:l(({record:i})=>[t(p,{color:i.target_type==="server"?"blue":"green"},{default:l(()=>[r(y(i.target_type==="server"?"\u670D\u52A1\u5668":"\u5E94\u7528"),1)]),_:2},1032,["color"])]),_:1}),t(f,{title:"\u6307\u6807",width:180},{cell:l(({record:i})=>[r(y(e.getMetricChineseName(i.metric))+" ",1),B("div",Fu,y(i.metric),1)]),_:1}),t(f,{title:"\u6761\u4EF6",width:200},{cell:l(({record:i})=>[r(y(e.getConditionText(i.condition))+" "+y(i.threshold)+y(e.getMetricUnit(i.metric)),1)]),_:1}),t(f,{title:"\u4E25\u91CD\u7A0B\u5EA6","data-index":"severity",width:100},{cell:l(({record:i})=>[t(p,{color:e.getSeverityColor(i.severity)},{default:l(()=>[r(y(e.getSeverityText(i.severity)),1)]),_:2},1032,["color"])]),_:1}),t(f,{title:"\u901A\u77E5","data-index":"notifiers",width:150},{cell:l(({record:i})=>[t(w,{wrap:""},{default:l(()=>[(k(!0),U(L,null,J(i.notifiers,o=>(k(),q(p,{key:o,size:"small"},{default:l(()=>[r(y(e.getNotifierName(o)),1)]),_:2},1024))),128)),!i.notifiers||i.notifiers.length===0?(k(),q(p,{key:0,size:"small"},{default:l(()=>u[13]||(u[13]=[r(" \u65E0 ")])),_:1})):j("",!0)]),_:2},1024)]),_:1}),t(f,{title:"\u72B6\u6001","data-index":"enabled",width:80},{cell:l(({record:i})=>[t(p,{color:i.enabled?"green":"gray"},{default:l(()=>[r(y(i.enabled?"\u542F\u7528":"\u7981\u7528"),1)]),_:2},1032,["color"])]),_:1}),t(f,{title:"\u64CD\u4F5C",width:240,fixed:"right"},{cell:l(({record:i})=>[t(w,null,{default:l(()=>[t(g,{"model-value":i.enabled,onChange:o=>e.toggleRule(i)},null,8,["model-value","onChange"]),t(b,{style:{height:"16px"},direction:"vertical"}),t(F,{type:"text",size:"small",onClick:o=>e.openEditRuleModal(i)},{default:l(()=>u[14]||(u[14]=[r(" \u7F16\u8F91 ")])),_:2},1032,["onClick"]),t(b,{style:{height:"16px"},direction:"vertical"}),t($,{content:"\u786E\u5B9A\u8981\u5220\u9664\u8BE5\u89C4\u5219\u5417\uFF1F",onOk:o=>e.deleteRule(i.id)},{default:l(()=>[t(F,{type:"text",status:"danger",size:"small"},{default:l(()=>u[15]||(u[15]=[r(" \u5220\u9664 ")])),_:1})]),_:2},1032,["onOk"])]),_:2},1024)]),_:1})]),_:1},8,["data","loading","pagination","onPageChange"]),t(W,{visible:e.ruleFormVisible,"onUpdate:visible":u[10]||(u[10]=i=>e.ruleFormVisible=i),title:e.isEdit?"\u7F16\u8F91\u544A\u8B66\u89C4\u5219":"\u6DFB\u52A0\u544A\u8B66\u89C4\u5219",onBeforeOk:e.handleSubmitRule},{default:l(()=>[t(O,{ref:"ruleFormRef",model:e.ruleForm,rules:e.ruleFormRules},{default:l(()=>[t(A,{field:"name",label:"\u89C4\u5219\u540D\u79F0"},{default:l(()=>[t(N,{modelValue:e.ruleForm.name,"onUpdate:modelValue":u[0]||(u[0]=i=>e.ruleForm.name=i),placeholder:"\u8BF7\u8F93\u5165\u89C4\u5219\u540D\u79F0"},null,8,["modelValue"])]),_:1}),t(A,{field:"target_type",label:"\u76EE\u6807\u7C7B\u578B"},{default:l(()=>[t(V,{modelValue:e.ruleForm.target_type,"onUpdate:modelValue":u[1]||(u[1]=i=>e.ruleForm.target_type=i)},{default:l(()=>[t(S,{value:"server"},{default:l(()=>u[16]||(u[16]=[r("\u670D\u52A1\u5668")])),_:1}),t(S,{value:"application"},{default:l(()=>u[17]||(u[17]=[r("\u5E94\u7528")])),_:1})]),_:1},8,["modelValue"])]),_:1}),t(A,{field:"metric",label:"\u6307\u6807"},{default:l(()=>[t(m,{modelValue:e.ruleForm.metric,"onUpdate:modelValue":u[2]||(u[2]=i=>e.ruleForm.metric=i),placeholder:"\u8BF7\u9009\u62E9\u6307\u6807\u540D\u79F0",loading:e.metricsLoading},{default:l(()=>[(k(!0),U(L,null,J(e.ruleForm.target_type==="server"?e.serverMetrics:e.appMetrics,i=>(k(),q(D,{key:i,value:i,label:e.getMetricChineseName(i)},{default:l(()=>[r(y(e.getMetricChineseName(i))+" ",1),B("span",yu,"("+y(i)+")",1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue","loading"])]),_:1}),t(A,{field:"description",label:"\u63CF\u8FF0"},{default:l(()=>[t(s,{modelValue:e.ruleForm.description,"onUpdate:modelValue":u[3]||(u[3]=i=>e.ruleForm.description=i),placeholder:"\u8BF7\u8F93\u5165\u89C4\u5219\u63CF\u8FF0"},null,8,["modelValue"])]),_:1}),t(A,{field:"condition",label:"\u6761\u4EF6"},{default:l(()=>[t(w,null,{default:l(()=>[t(m,{modelValue:e.ruleForm.condition,"onUpdate:modelValue":u[4]||(u[4]=i=>e.ruleForm.condition=i),style:{width:"100px"}},{default:l(()=>[t(D,{value:"gt"},{default:l(()=>u[18]||(u[18]=[r("\u5927\u4E8E")])),_:1}),t(D,{value:"lt"},{default:l(()=>u[19]||(u[19]=[r("\u5C0F\u4E8E")])),_:1}),t(D,{value:"gte"},{default:l(()=>u[20]||(u[20]=[r("\u5927\u4E8E\u7B49\u4E8E")])),_:1}),t(D,{value:"lte"},{default:l(()=>u[21]||(u[21]=[r("\u5C0F\u4E8E\u7B49\u4E8E")])),_:1}),t(D,{value:"eq"},{default:l(()=>u[22]||(u[22]=[r("\u7B49\u4E8E")])),_:1}),t(D,{value:"neq"},{default:l(()=>u[23]||(u[23]=[r("\u4E0D\u7B49\u4E8E")])),_:1}),t(D,{value:"change_rate"},{default:l(()=>u[24]||(u[24]=[r("\u53D8\u5316\u7387")])),_:1})]),_:1},8,["modelValue"]),t(d,{modelValue:e.ruleForm.threshold,"onUpdate:modelValue":u[5]||(u[5]=i=>e.ruleForm.threshold=i),placeholder:"\u9608\u503C"},null,8,["modelValue"]),e.ruleForm.metric&&e.getMetricUnit(e.ruleForm.metric)?(k(),U("span",bu,y(e.getMetricUnit(e.ruleForm.metric)),1)):j("",!0)]),_:1})]),_:1}),t(A,{field:"duration",label:"\u6301\u7EED\u65F6\u95F4"},{default:l(()=>[t(m,{modelValue:e.ruleForm.duration,"onUpdate:modelValue":u[6]||(u[6]=i=>e.ruleForm.duration=i)},{default:l(()=>[t(D,{value:"0"},{default:l(()=>u[25]||(u[25]=[r("\u7ACB\u5373\u89E6\u53D1")])),_:1}),t(D,{value:"1m"},{default:l(()=>u[26]||(u[26]=[r("\u6301\u7EED1\u5206\u949F")])),_:1}),t(D,{value:"5m"},{default:l(()=>u[27]||(u[27]=[r("\u6301\u7EED5\u5206\u949F")])),_:1}),t(D,{value:"10m"},{default:l(()=>u[28]||(u[28]=[r("\u6301\u7EED10\u5206\u949F")])),_:1}),t(D,{value:"30m"},{default:l(()=>u[29]||(u[29]=[r("\u6301\u7EED30\u5206\u949F")])),_:1}),t(D,{value:"1h"},{default:l(()=>u[30]||(u[30]=[r("\u6301\u7EED1\u5C0F\u65F6")])),_:1})]),_:1},8,["modelValue"])]),_:1}),t(A,{field:"severity",label:"\u4E25\u91CD\u7A0B\u5EA6"},{default:l(()=>[t(m,{modelValue:e.ruleForm.severity,"onUpdate:modelValue":u[7]||(u[7]=i=>e.ruleForm.severity=i)},{default:l(()=>[t(D,{value:"critical"},{default:l(()=>u[31]||(u[31]=[r("\u4E25\u91CD")])),_:1}),t(D,{value:"warning"},{default:l(()=>u[32]||(u[32]=[r("\u8B66\u544A")])),_:1}),t(D,{value:"info"},{default:l(()=>u[33]||(u[33]=[r("\u4FE1\u606F")])),_:1})]),_:1},8,["modelValue"])]),_:1}),t(A,{field:"notifiers",label:"\u901A\u77E5"},{default:l(()=>[t(m,{modelValue:e.ruleForm.notifiers,"onUpdate:modelValue":u[8]||(u[8]=i=>e.ruleForm.notifiers=i),placeholder:"\u8BF7\u9009\u62E9\u901A\u77E5\u65B9\u5F0F",multiple:"","allow-create":""},{default:l(()=>[(k(!0),U(L,null,J(e.notifiers,i=>(k(),q(D,{key:i.id,value:i.id,label:i.name},{default:l(()=>[r(y(i.name)+" ("+y(e.getNotifierTypeText(i.type))+") ",1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(A,{field:"enabled",label:"\u72B6\u6001"},{default:l(()=>[t(g,{modelValue:e.ruleForm.enabled,"onUpdate:modelValue":u[9]||(u[9]=i=>e.ruleForm.enabled=i)},null,8,["modelValue"]),B("span",Eu,y(e.ruleForm.enabled?"\u542F\u7528":"\u7981\u7528"),1)]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["visible","title","onBeforeOk"])])}const Bu=K(vu,[["render",Du]]),_u=Z({name:"NotifierManager",props:{refreshInterval:{type:Number,default:6e4},refreshTrigger:{type:Number,default:0}},setup(e){const u=_([]),I=_(!1),M=_({total:0,current:1,pageSize:10}),C=te(()=>{const{current:m,pageSize:s}=M.value,d=(m-1)*s,O=d+s,W=u.value;return W.slice(d,Math.min(O,W.length))}),R=_(),c=_(!1),F=_(!1),a=be({id:"",name:"",type:"email",config:{},enabled:!0}),w={name:[{required:!0,message:"\u8BF7\u8F93\u5165\u901A\u77E5\u5668\u540D\u79F0"}],type:[{required:!0,message:"\u8BF7\u9009\u62E9\u901A\u77E5\u5668\u7C7B\u578B"}]},E=m=>{switch(m){case"email":return"\u90AE\u4EF6";case"webhook":return"Webhook";case"dingtalk":return"\u9489\u9489";case"wechat":return"\u5FAE\u4FE1";default:return m}},h=m=>{if(!m)return"-";try{const s=new URL(m);return`${s.protocol}//${s.hostname}/...`}catch{return m.length>20?m.substring(0,10)+"..."+m.substring(m.length-10):m}},f=m=>{if(!m)return"-";const s=typeof m=="number"?new Date(m*1e3):new Date(m);return Fe(s).format("YYYY-MM-DD HH:mm:ss")},p=async()=>{I.value=!0;try{const m=await we();m.data&&(u.value=m.data,M.value.total=u.value.length)}catch(m){console.error("\u83B7\u53D6\u901A\u77E5\u5668\u5217\u8868\u5931\u8D25:",m),v.error("\u83B7\u53D6\u901A\u77E5\u5668\u5217\u8868\u5931\u8D25")}finally{I.value=!1}},g=m=>{M.value.current=m},b=m=>{switch(a.config={},String(m)){case"email":a.config={recipients:"",subject_prefix:"[\u76D1\u63A7\u544A\u8B66]"};break;case"webhook":a.config={url:"",method:"POST",max_alerts:10};break;case"dingtalk":a.config={webhook_url:"",secret:""};break;case"wechat":a.config={webhook_url:"",message_type:"text"};break}},$=()=>{F.value=!1,a.id="",a.name="",a.type="email",a.enabled=!0,b("email"),c.value=!0},T=m=>{F.value=!0,a.id=m.id,a.name=m.name,a.type=m.type,a.config={...m.config},a.enabled=m.enabled,c.value=!0},N=async()=>{try{if(F.value)if((await Je(a.id,{name:a.name,type:a.type,config:a.config,enabled:a.enabled})).data)v.success("\u66F4\u65B0\u901A\u77E5\u5668\u6210\u529F"),p();else return v.error("\u66F4\u65B0\u901A\u77E5\u5668\u5931\u8D25"),!1;else if((await Ge({name:a.name,type:a.type,config:a.config,enabled:a.enabled})).data)v.success("\u521B\u5EFA\u901A\u77E5\u5668\u6210\u529F"),p();else return v.error("\u521B\u5EFA\u901A\u77E5\u5668\u5931\u8D25"),!1}catch(m){return console.error("\u63D0\u4EA4\u901A\u77E5\u5668\u5931\u8D25:",m),v.error("\u63D0\u4EA4\u901A\u77E5\u5668\u5931\u8D25"),!1}},A=async m=>{try{(await Xe(m.id)).data?(v.success("\u5220\u9664\u901A\u77E5\u5668\u6210\u529F"),p()):v.error("\u5220\u9664\u901A\u77E5\u5668\u5931\u8D25")}catch(s){console.error("\u5220\u9664\u901A\u77E5\u5668\u5931\u8D25:",s),v.error("\u5220\u9664\u901A\u77E5\u5668\u5931\u8D25")}},S=async m=>{try{(await Ke(m.id)).data?v.success("\u6D4B\u8BD5\u901A\u77E5\u5DF2\u53D1\u9001"):v.error("\u6D4B\u8BD5\u901A\u77E5\u53D1\u9001\u5931\u8D25")}catch(s){console.error("\u6D4B\u8BD5\u901A\u77E5\u5668\u5931\u8D25:",s),v.error("\u6D4B\u8BD5\u901A\u77E5\u5668\u5931\u8D25")}},V=async(m,s)=>{try{(await Qe(m.id,{enabled:s})).data?(v.success(`${s?"\u542F\u7528":"\u7981\u7528"}\u901A\u77E5\u5668\u6210\u529F`),p()):v.error(`${s?"\u542F\u7528":"\u7981\u7528"}\u901A\u77E5\u5668\u5931\u8D25`)}catch(d){console.error(`${s?"\u542F\u7528":"\u7981\u7528"}\u901A\u77E5\u5668\u5931\u8D25:`,d),v.error(`${s?"\u542F\u7528":"\u7981\u7528"}\u901A\u77E5\u5668\u5931\u8D25`)}};let D=null;return z(()=>e.refreshTrigger,()=>{p()}),z(()=>e.refreshInterval,m=>{D&&(clearInterval(D),D=null),m>0&&(D=window.setInterval(()=>{p()},m))}),x(()=>{p()}),le(()=>{D&&(clearInterval(D),D=null)}),{notifiers:u,tableData:C,loading:I,pagination:M,notifierFormRef:R,notifierFormVisible:c,isEdit:F,notifierForm:a,formRules:w,getNotifierTypeText:E,maskUrl:h,formatDateTime:f,fetchData:p,onPageChange:g,handleTypeChange:b,openAddNotifierModal:$,openEditNotifierModal:T,handleSubmitNotifier:N,deleteNotifierAction:A,testNotifierAction:S,toggleNotifierAction:V}}}),hu={style:{"max-width":"300px","word-break":"break-all"}},Cu={style:{"margin-left":"12px"}};function Au(e,u,I,M,C,R){const c=Ee,F=oe,a=Q,w=ie,E=ee,h=ue,f=fe,p=me,g=De,b=ne,$=ge,T=pe,N=Be,A=se,S=ae,V=re,D=_e,m=de,s=ce;return k(),U("div",null,[t(h,{style:{"margin-bottom":"16px"}},{default:l(()=>[t(E,{span:24},{default:l(()=>[t(w,null,{default:l(()=>[t(F,{type:"primary",onClick:e.openAddNotifierModal},{icon:l(()=>[t(c)]),default:l(()=>[u[13]||(u[13]=r(" \u6DFB\u52A0\u901A\u77E5\u5668 "))]),_:1},8,["onClick"]),t(F,{onClick:e.fetchData},{icon:l(()=>[t(a)]),default:l(()=>[u[14]||(u[14]=r(" \u5237\u65B0 "))]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1}),t(T,{data:e.tableData,loading:e.loading,pagination:e.pagination,onPageChange:e.onPageChange},{columns:l(()=>[t(f,{title:"ID","data-index":"id",width:80}),t(f,{title:"\u540D\u79F0","data-index":"name"}),t(f,{title:"\u7C7B\u578B","data-index":"type",width:120},{cell:l(({record:d})=>[t(p,null,{default:l(()=>[r(y(e.getNotifierTypeText(d.type)),1)]),_:2},1024)]),_:1}),t(f,{title:"\u914D\u7F6E",width:300},{cell:l(({record:d})=>[B("div",hu,[d.type==="email"?(k(),U(L,{key:0},[r(" \u6536\u4EF6\u4EBA: "+y(d.config.recipients||"-"),1)],64)):d.type==="webhook"?(k(),U(L,{key:1},[r(" URL: "+y(d.config.url||"-"),1)],64)):d.type==="dingtalk"?(k(),U(L,{key:2},[r(" Webhook: "+y(e.maskUrl(d.config.webhook_url)||"-"),1)],64)):d.type==="wechat"?(k(),U(L,{key:3},[r(" Webhook: "+y(e.maskUrl(d.config.webhook_url)||"-"),1)],64)):(k(),U(L,{key:4},[r(" \u914D\u7F6E\u8BE6\u60C5\u8BF7\u7F16\u8F91\u67E5\u770B ")],64))])]),_:1}),t(f,{title:"\u72B6\u6001","data-index":"enabled",width:80},{cell:l(({record:d})=>[t(p,{color:d.enabled?"green":"gray"},{default:l(()=>[r(y(d.enabled?"\u542F\u7528":"\u7981\u7528"),1)]),_:2},1032,["color"])]),_:1}),t(f,{title:"\u521B\u5EFA\u65F6\u95F4","data-index":"created_at",width:180},{cell:l(({record:d})=>[r(y(e.formatDateTime(d.created_at)),1)]),_:1}),t(f,{title:"\u64CD\u4F5C",width:240,fixed:"right"},{cell:l(({record:d})=>[t(w,null,{default:l(()=>[t(g,{"model-value":d.enabled,onChange:O=>e.toggleNotifierAction(d,Boolean(O))},null,8,["model-value","onChange"]),t(b,{style:{height:"16px"},direction:"vertical"}),t(F,{type:"text",size:"small",onClick:O=>e.testNotifierAction(d)},{default:l(()=>u[15]||(u[15]=[r(" \u6D4B\u8BD5 ")])),_:2},1032,["onClick"]),t(b,{style:{height:"16px"},direction:"vertical"}),t(F,{type:"text",size:"small",onClick:O=>e.openEditNotifierModal(d)},{default:l(()=>u[16]||(u[16]=[r(" \u7F16\u8F91 ")])),_:2},1032,["onClick"]),t(b,{style:{height:"16px"},direction:"vertical"}),t($,{content:"\u786E\u5B9A\u8981\u5220\u9664\u8BE5\u901A\u77E5\u5668\u5417\uFF1F",onOk:O=>e.deleteNotifierAction(d)},{default:l(()=>[t(F,{type:"text",status:"danger",size:"small"},{default:l(()=>u[17]||(u[17]=[r(" \u5220\u9664 ")])),_:1})]),_:2},1032,["onOk"])]),_:2},1024)]),_:1})]),_:1},8,["data","loading","pagination","onPageChange"]),t(s,{visible:e.notifierFormVisible,"onUpdate:visible":u[12]||(u[12]=d=>e.notifierFormVisible=d),title:e.isEdit?"\u7F16\u8F91\u901A\u77E5\u5668":"\u6DFB\u52A0\u901A\u77E5\u5668",onBeforeOk:e.handleSubmitNotifier},{default:l(()=>[t(m,{ref:"notifierFormRef",model:e.notifierForm,rules:e.formRules},{default:l(()=>[t(A,{field:"name",label:"\u540D\u79F0"},{default:l(()=>[t(N,{modelValue:e.notifierForm.name,"onUpdate:modelValue":u[0]||(u[0]=d=>e.notifierForm.name=d),placeholder:"\u8BF7\u8F93\u5165\u901A\u77E5\u5668\u540D\u79F0"},null,8,["modelValue"])]),_:1}),t(A,{field:"type",label:"\u7C7B\u578B"},{default:l(()=>[t(V,{modelValue:e.notifierForm.type,"onUpdate:modelValue":u[1]||(u[1]=d=>e.notifierForm.type=d),disabled:e.isEdit,onChange:e.handleTypeChange},{default:l(()=>[t(S,{value:"email"},{default:l(()=>u[18]||(u[18]=[r("\u90AE\u4EF6")])),_:1}),t(S,{value:"webhook"},{default:l(()=>u[19]||(u[19]=[r("Webhook")])),_:1}),t(S,{value:"dingtalk"},{default:l(()=>u[20]||(u[20]=[r("\u9489\u9489")])),_:1}),t(S,{value:"wechat"},{default:l(()=>u[21]||(u[21]=[r("\u5FAE\u4FE1")])),_:1})]),_:1},8,["modelValue","disabled","onChange"])]),_:1}),e.notifierForm.type==="email"?(k(),U(L,{key:0},[t(A,{field:"config.recipients",label:"\u6536\u4EF6\u4EBA"},{default:l(()=>[t(N,{modelValue:e.notifierForm.config.recipients,"onUpdate:modelValue":u[2]||(u[2]=d=>e.notifierForm.config.recipients=d),placeholder:"\u8BF7\u8F93\u5165\u6536\u4EF6\u4EBA\u90AE\u7BB1\uFF0C\u591A\u4E2A\u7528\u9017\u53F7\u5206\u9694"},null,8,["modelValue"])]),_:1}),t(A,{field:"config.subject_prefix",label:"\u4E3B\u9898\u524D\u7F00"},{default:l(()=>[t(N,{modelValue:e.notifierForm.config.subject_prefix,"onUpdate:modelValue":u[3]||(u[3]=d=>e.notifierForm.config.subject_prefix=d),placeholder:"\u8BF7\u8F93\u5165\u4E3B\u9898\u524D\u7F00"},null,8,["modelValue"])]),_:1})],64)):j("",!0),e.notifierForm.type==="webhook"?(k(),U(L,{key:1},[t(A,{field:"config.url",label:"URL"},{default:l(()=>[t(N,{modelValue:e.notifierForm.config.url,"onUpdate:modelValue":u[4]||(u[4]=d=>e.notifierForm.config.url=d),placeholder:"\u8BF7\u8F93\u5165Webhook URL"},null,8,["modelValue"])]),_:1}),t(A,{field:"config.method",label:"\u8BF7\u6C42\u65B9\u6CD5"},{default:l(()=>[t(V,{modelValue:e.notifierForm.config.method,"onUpdate:modelValue":u[5]||(u[5]=d=>e.notifierForm.config.method=d),"default-value":"POST"},{default:l(()=>[t(S,{value:"POST"},{default:l(()=>u[22]||(u[22]=[r("POST")])),_:1}),t(S,{value:"PUT"},{default:l(()=>u[23]||(u[23]=[r("PUT")])),_:1})]),_:1},8,["modelValue"])]),_:1}),t(A,{field:"config.max_alerts",label:"\u6700\u5927\u544A\u8B66\u6570"},{default:l(()=>[t(D,{modelValue:e.notifierForm.config.max_alerts,"onUpdate:modelValue":u[6]||(u[6]=d=>e.notifierForm.config.max_alerts=d),min:1,max:100},null,8,["modelValue"])]),_:1})],64)):j("",!0),e.notifierForm.type==="dingtalk"?(k(),U(L,{key:2},[t(A,{field:"config.webhook_url",label:"Webhook URL"},{default:l(()=>[t(N,{modelValue:e.notifierForm.config.webhook_url,"onUpdate:modelValue":u[7]||(u[7]=d=>e.notifierForm.config.webhook_url=d),placeholder:"\u8BF7\u8F93\u5165\u9489\u9489Webhook URL"},null,8,["modelValue"])]),_:1}),t(A,{field:"config.secret",label:"\u52A0\u7B7E\u5BC6\u94A5"},{default:l(()=>[t(N,{modelValue:e.notifierForm.config.secret,"onUpdate:modelValue":u[8]||(u[8]=d=>e.notifierForm.config.secret=d),placeholder:"\u8BF7\u8F93\u5165\u52A0\u7B7E\u5BC6\u94A5(\u53EF\u9009)"},null,8,["modelValue"])]),_:1})],64)):j("",!0),e.notifierForm.type==="wechat"?(k(),U(L,{key:3},[t(A,{field:"config.webhook_url",label:"Webhook URL"},{default:l(()=>[t(N,{modelValue:e.notifierForm.config.webhook_url,"onUpdate:modelValue":u[9]||(u[9]=d=>e.notifierForm.config.webhook_url=d),placeholder:"\u8BF7\u8F93\u5165\u4F01\u4E1A\u5FAE\u4FE1Webhook URL"},null,8,["modelValue"])]),_:1}),t(A,{field:"config.message_type",label:"\u6D88\u606F\u7C7B\u578B"},{default:l(()=>[t(V,{modelValue:e.notifierForm.config.message_type,"onUpdate:modelValue":u[10]||(u[10]=d=>e.notifierForm.config.message_type=d),"default-value":"text"},{default:l(()=>[t(S,{value:"text"},{default:l(()=>u[24]||(u[24]=[r("\u6587\u672C")])),_:1}),t(S,{value:"markdown"},{default:l(()=>u[25]||(u[25]=[r("Markdown")])),_:1})]),_:1},8,["modelValue"])]),_:1})],64)):j("",!0),t(A,{field:"enabled",label:"\u72B6\u6001"},{default:l(()=>[t(g,{modelValue:e.notifierForm.enabled,"onUpdate:modelValue":u[11]||(u[11]=d=>e.notifierForm.enabled=d)},null,8,["modelValue"]),B("span",Cu,y(e.notifierForm.enabled?"\u542F\u7528":"\u7981\u7528"),1)]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["visible","title","onBeforeOk"])])}const wu=K(_u,[["render",Au]]),ku=Z({name:"MonitorDashboard",components:{SystemOverview:iu,MetricChart:Ze,AlertTable:cu,AlertRules:Bu,NotifierManager:wu,IconRefresh:Q},setup(){const e=Ue(),u=_(3e4),I=_(0),M=_([]),C=_(""),R=_(!1),F=_((()=>{try{const g=window.location.hostname;return g==="localhost"||g==="127.0.0.1"?!0:/^(\d{1,3}\.){3}\d{1,3}$/.test(g)?g.startsWith("10.")||/^172\.(1[6-9]|2\d|3[0-1])\./.test(g)||g.startsWith("192.168."):!1}catch(g){return console.error("\u5224\u65AD\u8BBF\u95EE\u65B9\u5F0F\u51FA\u9519:",g),!1}})()?"internal":"public"),a=te(()=>{var $;if(!C.value)return null;const g=M.value.find(T=>T.id===C.value);if(!g)return null;const b=JSON.parse(JSON.stringify(g));return F.value==="public"&&(($=g.metadata)==null?void 0:$.public_ip)&&(b.address=g.metadata.public_ip),b}),w=async()=>{R.value=!0;try{const g=await xe("aio-service");if(g.data){M.value=g.data;const b=e.query.nodeId;if(b){const $=g.data.find(T=>T.id===b);$?(C.value=b,v.success(`\u5DF2\u81EA\u52A8\u9009\u62E9\u8282\u70B9: ${$.name} (${$.address})`),I.value+=1):v.warning(`\u672A\u627E\u5230\u8282\u70B9ID\u4E3A ${b} \u7684\u8282\u70B9`)}}}catch(g){console.error("\u83B7\u53D6\u670D\u52A1\u8282\u70B9\u5217\u8868\u5931\u8D25:",g),v.error("\u83B7\u53D6\u670D\u52A1\u8282\u70B9\u5217\u8868\u5931\u8D25")}finally{R.value=!1}},E=g=>{const b=String(g),$=M.value.find(T=>T.id===b);$?v.success(`\u5DF2\u5207\u6362\u5230\u8282\u70B9: ${$.name} (${$.address})`):v.success("\u5DF2\u5207\u6362\u5230\u5F53\u524D\u8282\u70B9"),I.value+=1},h=()=>{const g=a.value;g&&(v.success(`\u5DF2\u5207\u6362\u5230${F.value==="internal"?"\u5185\u7F51":"\u516C\u7F51"}IP: ${g.address}`),I.value+=1)},f=()=>{I.value+=1,v.success("\u6B63\u5728\u5237\u65B0\u6570\u636E...")},p=g=>{const b=Number(g);v.success(`\u5237\u65B0\u95F4\u9694\u5DF2\u66F4\u65B0\u4E3A${b===5e3?"5\u79D2":b===1e4?"10\u79D2":b===3e4?"30\u79D2":b===6e4?"1\u5206\u949F":"5\u5206\u949F"}`),I.value+=1};return z(()=>u.value,()=>{w()}),x(()=>{w()}),{refreshInterval:u,refreshTrigger:I,serviceNodes:M,selectedNodeId:C,selectedNodeWithIp:a,ipType:F,loadingNodes:R,refreshNow:f,onRefreshIntervalChange:p,onNodeChange:E,onIpTypeChange:h}}});const Vu={class:"container"},Nu={class:"tab-content"},$u={class:"card-title-with-selector"},Iu={class:"refresh-selector"},Tu={class:"chart-container"},Mu={class:"tab-content"},Su={class:"tab-content"},Uu={class:"tab-content"};function Pu(e,u,I,M,C,R){const c=ae,F=re,a=Q,w=oe,E=X("SystemOverview"),h=ve,f=ne,p=X("MetricChart"),g=ee,b=ue,$=Me,T=X("AlertTable"),N=X("AlertRules"),A=X("NotifierManager"),S=Se;return k(),U("div",Vu,[t(S,{"default-active-key":"overview"},{default:l(()=>[t($,{key:"overview",title:"\u7CFB\u7EDF\u6982\u89C8"},{default:l(()=>[B("div",Nu,[t(h,{class:"mb-4"},{title:l(()=>[B("div",$u,[u[15]||(u[15]=B("span",null,"\u7CFB\u7EDF\u8D44\u6E90",-1)),B("div",Iu,[u[12]||(u[12]=B("span",{class:"node-selector-label"},"\u8282\u70B9\u9009\u62E9\uFF1A",-1)),t(F,{modelValue:e.selectedNodeId,"onUpdate:modelValue":u[0]||(u[0]=V=>e.selectedNodeId=V),style:{width:"200px"},size:"small",loading:e.loadingNodes,onChange:e.onNodeChange},{default:l(()=>[t(c,{value:""},{default:l(()=>u[3]||(u[3]=[r("\u5F53\u524D\u8282\u70B9")])),_:1}),(k(!0),U(L,null,J(e.serviceNodes,V=>(k(),q(c,{key:V.id,value:V.id},{default:l(()=>[r(y(V.name)+" ("+y(V.address)+") ",1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue","loading","onChange"]),u[13]||(u[13]=B("span",{class:"ip-type-label",style:{"margin-left":"16px"}},"IP\u7C7B\u578B\uFF1A",-1)),t(F,{modelValue:e.ipType,"onUpdate:modelValue":u[1]||(u[1]=V=>e.ipType=V),style:{width:"100px"},size:"small",disabled:!e.selectedNodeId,onChange:e.onIpTypeChange},{default:l(()=>[t(c,{value:"internal"},{default:l(()=>u[4]||(u[4]=[r("\u5185\u7F51IP")])),_:1}),t(c,{value:"public"},{default:l(()=>u[5]||(u[5]=[r("\u516C\u7F51IP")])),_:1})]),_:1},8,["modelValue","disabled","onChange"]),u[14]||(u[14]=B("span",{class:"refresh-label",style:{"margin-left":"16px"}},"\u5237\u65B0\u95F4\u9694\uFF1A",-1)),t(F,{modelValue:e.refreshInterval,"onUpdate:modelValue":u[2]||(u[2]=V=>e.refreshInterval=V),style:{width:"120px"},size:"small",onChange:e.onRefreshIntervalChange},{default:l(()=>[t(c,{value:5e3},{default:l(()=>u[6]||(u[6]=[r("5\u79D2")])),_:1}),t(c,{value:1e4},{default:l(()=>u[7]||(u[7]=[r("10\u79D2")])),_:1}),t(c,{value:3e4},{default:l(()=>u[8]||(u[8]=[r("30\u79D2")])),_:1}),t(c,{value:6e4},{default:l(()=>u[9]||(u[9]=[r("1\u5206\u949F")])),_:1}),t(c,{value:3e5},{default:l(()=>u[10]||(u[10]=[r("5\u5206\u949F")])),_:1})]),_:1},8,["modelValue","onChange"]),t(w,{type:"text",size:"small",class:"refresh-button",onClick:e.refreshNow},{icon:l(()=>[t(a)]),default:l(()=>[u[11]||(u[11]=r(" \u7ACB\u5373\u5237\u65B0 "))]),_:1},8,["onClick"])])])]),default:l(()=>[t(E,{"refresh-interval":e.refreshInterval,"refresh-trigger":e.refreshTrigger,"selected-node":e.selectedNodeWithIp},null,8,["refresh-interval","refresh-trigger","selected-node"])]),_:1}),t(f,{style:{margin:"0"}}),B("div",Tu,[t(b,{gutter:16},{default:l(()=>[t(g,{span:12,xs:24,md:12,lg:12,class:"mb-4"},{default:l(()=>[t(p,{title:"CPU\u4F7F\u7528\u7387\u8D8B\u52BF",metrics:"cpu.usage","refresh-interval":e.refreshInterval,"refresh-trigger":e.refreshTrigger,"chart-type":"line",colors:["#3370ff"],"selected-node":e.selectedNodeWithIp},null,8,["refresh-interval","refresh-trigger","selected-node"])]),_:1}),t(g,{span:12,xs:24,md:12,lg:12,class:"mb-4"},{default:l(()=>[t(p,{title:"\u5185\u5B58\u4F7F\u7528\u7387\u8D8B\u52BF",metrics:"memory.usage","refresh-interval":e.refreshInterval,"refresh-trigger":e.refreshTrigger,"chart-type":"line",colors:["#14c9c9"],"selected-node":e.selectedNodeWithIp},null,8,["refresh-interval","refresh-trigger","selected-node"])]),_:1})]),_:1}),t(b,{gutter:16},{default:l(()=>[t(g,{span:12,xs:24,md:12,lg:12,class:"mb-4"},{default:l(()=>[t(p,{title:"\u78C1\u76D8I/O",metrics:"disk.io.read,disk.io.write","refresh-interval":e.refreshInterval,"refresh-trigger":e.refreshTrigger,"chart-type":"line",colors:["#168cff","#ff7d00"],"selected-node":e.selectedNodeWithIp},null,8,["refresh-interval","refresh-trigger","selected-node"])]),_:1}),t(g,{span:12,xs:24,md:12,lg:12,class:"mb-4"},{default:l(()=>[t(p,{title:"\u7F51\u7EDC\u6D41\u91CF",metrics:"net.in,net.out","refresh-interval":e.refreshInterval,"refresh-trigger":e.refreshTrigger,"chart-type":"line",colors:["#00b42a","#f53f3f"],"selected-node":e.selectedNodeWithIp},null,8,["refresh-interval","refresh-trigger","selected-node"])]),_:1})]),_:1})])])]),_:1}),t($,{key:"alerts",title:"\u6D3B\u8DC3\u544A\u8B66"},{default:l(()=>[B("div",Mu,[t(h,null,{default:l(()=>[t(T,{"refresh-interval":e.refreshInterval,"refresh-trigger":e.refreshTrigger},null,8,["refresh-interval","refresh-trigger"])]),_:1})])]),_:1}),t($,{key:"rules",title:"\u544A\u8B66\u89C4\u5219"},{default:l(()=>[B("div",Su,[t(h,null,{default:l(()=>[t(N,{"refresh-interval":e.refreshInterval,"refresh-trigger":e.refreshTrigger},null,8,["refresh-interval","refresh-trigger"])]),_:1})])]),_:1}),t($,{key:"notifiers",title:"\u901A\u77E5\u7BA1\u7406"},{default:l(()=>[B("div",Uu,[t(h,null,{default:l(()=>[t(A,{"refresh-interval":e.refreshInterval,"refresh-trigger":e.refreshTrigger},null,8,["refresh-interval","refresh-trigger"])]),_:1})])]),_:1})]),_:1})])}const at=K(ku,[["render",Pu],["__scopeId","data-v-4b8f4d17"]]);export{at as default};
