# Agent 守护进程配置示例
# 复制此文件到 /etc/xiaozhizhang/agent.yaml 并根据实际情况修改

# JWT 配置（用于验证客户端 token）
jwt:
  secret: "your-jwt-secret-must-match-main-server"  # 必须与主服务器的 JWT secret 一致
  expires: 86400  # token 过期时间（秒），默认 24 小时

# Agent 配置
agent:
  # gRPC 监听地址（默认仅监听 localhost，如需远程访问请配置 TLS）
  address: "127.0.0.1:50052"
  
  # 命令执行超时（Go duration 格式，如 30s, 1m）
  timeout: 30s
  
  # Nginx 配置
  nginx:
    # 配置文件根目录
    root_dir: "/etc/nginx/conf.d"
    # 文件权限（八进制字符串）
    file_mode: "0644"
    # 校验命令
    validate_command: "nginx -t"
    # 重载命令
    reload_command: "nginx -s reload"
  
  # Systemd 配置
  systemd:
    # unit 文件目录
    unit_dir: "/etc/systemd/system"
  
  # 安装任务配置
  install:
    # 安装根目录
    install_root: "/opt/xiaozhizhang/apps"
    # Bundle 存储目录
    bundle_dir: "/opt/xiaozhizhang/bundles"
    # 保留版本数
    keep_releases: 5
    # 最大 Bundle 大小（字节，默认 1GB）
    max_bundle_size: 1073741824
    # 最大超时时间（Go duration 格式）
    max_timeout: 30m
    # 允许的模板 ID（空表示全部允许，生产环境建议配置白名单）
    allowed_templates: []
    # allowed_templates:
    #   - install_binary
    #   - deploy_config
    #   - cleanup_old_releases
    #   - health_check

